<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>煎饼的博客</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://jianbing.github.io/"/>
  <updated>2016-11-10T08:18:00.270Z</updated>
  <id>http://jianbing.github.io/</id>
  
  <author>
    <name>煎饼</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>聊一聊Python2的编码坑</title>
    <link href="http://jianbing.github.io/2016/11/10/python-str-unicode/"/>
    <id>http://jianbing.github.io/2016/11/10/python-str-unicode/</id>
    <published>2016-11-09T16:00:00.000Z</published>
    <updated>2016-11-10T08:18:00.270Z</updated>
    
    <content type="html"><![CDATA[<p>Py2的编码问题真是历史悠久，下边这个报错更是经常见到。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UnicodeDecodeError: <span class="string">'ascii'</span> codec can<span class="string">'t decode byte 0xe9 in position 2: ordinal not in range(128)</span></div></pre></td></tr></table></figure></p>
<p>在避开Py2的编码坑之前，我们需要了解一下一些常见的编码。</p>
<a id="more"></a>
<h3 id="常见编码"><a href="#常见编码" class="headerlink" title="常见编码"></a>常见编码</h3><h4 id="ASCII"><a href="#ASCII" class="headerlink" title="ASCII"></a>ASCII</h4><p>ASCII（American Standard Code for Information Interchange，美国信息交换标准代码）是基于拉丁字母的一套电脑编码系统，主要用于显示现代英语和其他西欧语言。它是现今最通用的单字节编码系统。</p>
<h4 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h4><p>Unicode（统一码、万国码、单一码）是计算机科学领域里的一项业界标准,包括字符集、编码方案等。Unicode 是为了解决传统的字符编码方案的局限而产生的，它为每种语言中的每个字符设定了统一并且唯一的二进制编码，以满足跨语言、跨平台进行文本转换、处理的要求。</p>
<h4 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h4><p>UTF-8（8-bit Unicode Transformation Format）是一种针对Unicode的可变长度字符编码，又称万国码。由Ken Thompson于1992年创建。现在已经标准化为RFC 3629。UTF-8用1到4个字节编码Unicode字符。用在网页上可以统一页面显示中文简体繁体及其它语言（如英文，日文，韩文）。</p>
<h4 id="GB2312"><a href="#GB2312" class="headerlink" title="GB2312"></a>GB2312</h4><p>GB2312编码由中国国家标准总局1980年发布，1981年5月1日开始实施的一套国家标准，适用于汉字处理、汉字通信等系统之间的信息交换，通行于中国大陆；新加坡等地也采用此编码。中国大陆几乎所有的中文系统和国际化的软件都支持GB2312。基本集共收入汉字6763个和非汉字图形字符682个。</p>
<h4 id="GBK"><a href="#GBK" class="headerlink" title="GBK"></a>GBK</h4><p>GB2312的出现，基本满足了汉字的计算机处理需要，它所收录的汉字已经覆盖中国大陆99.75%的使用频率，不过 GB2312 还是不能100%满足中国汉字的需求，对一些罕见的字和繁体字 GB2312 没法处理，后来就在GB2312的基础上创建了一种叫GBK 的编码，GBK不仅收录了27484个汉字，同时还收录了藏文、蒙文、维吾尔文等主要的少数民族文字。</p>
<h3 id="编码问题"><a href="#编码问题" class="headerlink" title="编码问题"></a>编码问题</h3><p>背景介绍完毕。回到Python2当中，Python2默认编码是ASCII。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getdefaultencoding()</div><div class="line"><span class="string">'ascii'</span></div></pre></td></tr></table></figure>
<p>如果.py文件中包含中文字符（严格的说是含有非anscii字符），则需要在第一行或第二行指定编码声明：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div></pre></td></tr></table></figure></p>
<p>否认将会看到这样的报错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SyntaxError: Non-ASCII character <span class="string">'\xe4'</span> <span class="keyword">in</span> file C:/github/sgauto/test.py on line <span class="number">4</span>, but no encoding declared; see http://python.org/dev/peps/pep<span class="number">-0263</span>/ <span class="keyword">for</span> details</div></pre></td></tr></table></figure>
<p>在Python2中有两种字符串类型，分别是str和unicode，他们都是basestring的派生类。</p>
<p>对unicode进行指定格式的编码后，就是str。<br>对str进行指定格式的解码后，就是unicode。</p>
<p>举个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line">hi = <span class="string">'今天天气不错'</span></div><div class="line"><span class="keyword">print</span> type(hi)</div><div class="line"><span class="keyword">print</span> type(hi.decode(<span class="string">'utf-8'</span>))</div><div class="line"><span class="keyword">print</span> <span class="string">"-"</span>*<span class="number">50</span></div><div class="line">hello = <span class="string">u'今天天气不错'</span></div><div class="line"><span class="keyword">print</span> type(hello)</div><div class="line"><span class="keyword">print</span> type(hello.encode(<span class="string">'utf-8'</span>))</div><div class="line"></div><div class="line">output:</div><div class="line">&lt;type <span class="string">'str'</span>&gt;</div><div class="line">&lt;type <span class="string">'unicode'</span>&gt;</div><div class="line">--------------------------------------------------</div><div class="line">&lt;type <span class="string">'unicode'</span>&gt;</div><div class="line">&lt;type <span class="string">'str'</span>&gt;</div></pre></td></tr></table></figure>
<p>也就是说，utf-8，gb2312，gbk编码的字符串，都可以通过decode函数，转换为unicode，而unicode字符串，可以通过encode函数指定编码，转换为utf-8，gb2312，gbk等任意编码的字符串。</p>
<p>unicode就是一个编码转换的中间人。</p>
<p>避开编码坑，最重要的就是清楚源字符串的编码和输出环境的编码。最好是在Python处理过程中，都先转换为unicode，在最后输出的时候，再进行编码。</p>
<p>举个乱码的例子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'今天天气不错'</span></div></pre></td></tr></table></figure>
<p>在IDE里边，一切正常，可是当你在Windows的CMD下运行的时候，乱码鸟</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">浠婂ぉ澶╂皵涓嶉敊</div></pre></td></tr></table></figure>
<p>这是为什么呢？CMD的默认输出编码是GB2312，而我们提供的是UTF-8编码的字符串，于是解析的时候，出现了乱码。</p>
<p>解决方案一：</p>
<p>修改CMD的默认编码为UTF-8，在CMD里边输入 CHCP 65001即可。</p>
<p>解决方案二：<br>在Py文件里边，将字符串的编码转换成Unicode，这样可以有几种写法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'今天天气不错'</span>.decode(<span class="string">'utf-8'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">u'今天天气不错'</span></div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'今天天气不错'</span></div></pre></td></tr></table></figure>
<p>最推荐的方式是第三种，通过__future__模块引入Py3的一个新特性，字符串默认使用unicode编码。</p>
<p>而在文章最开始列出来的报错，有两种常见情况。</p>
<p>一是unicode和str混用，进行了运算<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line">hi = <span class="string">u"今天"</span> + <span class="string">"天气真好"</span></div><div class="line"></div><div class="line">output:</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"C:/github/sgauto/test.py"</span>, line <span class="number">5</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    hi = <span class="string">u"今天"</span> + <span class="string">"天气真好"</span></div><div class="line">UnicodeDecodeError: <span class="string">'ascii'</span> codec can<span class="string">'t decode byte 0xe5 in position 0: ordinal not in range(128)</span></div></pre></td></tr></table></figure></p>
<p>二是对字符串进行编码解码的时候，指定了错了编码类型。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"><span class="keyword">print</span> <span class="string">"今天天气真好"</span>.encode(<span class="string">'gb2312'</span>)</div><div class="line"></div><div class="line">output:</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"C:/github/sgauto/test.py"</span>, line <span class="number">5</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    <span class="keyword">print</span> <span class="string">"今天天气真好"</span>.encode(<span class="string">'gb2312'</span>)</div><div class="line">UnicodeDecodeError: <span class="string">'ascii'</span> codec can<span class="string">'t decode byte 0xe4 in position 0: ordinal not in range(128)</span></div></pre></td></tr></table></figure></p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>在Python2中，进行编码转化时候，需要先转为unicode编码，再进行下一步的转化。如：utf-8—&gt;unicode—&gt;gb2312</p>
<h3 id="推荐实践"><a href="#推荐实践" class="headerlink" title="推荐实践"></a>推荐实践</h3><ul>
<li><p>从__future__模块引入unicode_literals</p>
</li>
<li><p>使用chardet检测编码格式，chardet是一个检测字符串编码的第三方库，必备神器，通过 pip install chardet 安装。</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"><span class="keyword">import</span> chardet</div><div class="line">hi = <span class="string">'今天天气不错'</span></div><div class="line"><span class="keyword">print</span> chardet.detect(hi)</div><div class="line"></div><div class="line">output:</div><div class="line">&#123;<span class="string">'confidence'</span>: <span class="number">0.99</span>, <span class="string">'encoding'</span>: <span class="string">'utf-8'</span>&#125;</div></pre></td></tr></table></figure>
<ul>
<li>使用codecs打开文件</li>
</ul>
<p>上文提到，推荐在Py内处理文本之前，都先转为unicode编码，自带的open函数，并不具备这个功能，推荐使用codecs模块的open函数来打开文件，同时指定文件编码，将读取的文本转化为unicode编码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> codecs</div><div class="line"></div><div class="line"><span class="keyword">with</span> codecs.open(<span class="string">"a.txt"</span>,<span class="string">'r'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</div><div class="line">    <span class="keyword">print</span> f.read()</div></pre></td></tr></table></figure>
<hr>
<h3 id="说点别的"><a href="#说点别的" class="headerlink" title="说点别的"></a>说点别的</h3><p>经常会看到有人问这样一个问题：打印字典和列表的时候，怎么显示成中文？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"></div><div class="line">hello = &#123;<span class="string">'hi'</span>: <span class="string">"今天天气真好"</span>&#125;</div><div class="line"><span class="keyword">print</span> hello</div><div class="line"></div><div class="line">output:</div><div class="line">&#123;<span class="string">'hi'</span>: <span class="string">'\xe4\xbb\x8a\xe5\xa4\xa9\xe5\xa4\xa9\xe6\xb0\x94\xe7\x9c\x9f\xe5\xa5\xbd'</span>&#125;</div></pre></td></tr></table></figure>
<p>解决方法是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"><span class="keyword">import</span> json</div><div class="line"></div><div class="line">hello = &#123;<span class="string">'hi'</span>: <span class="string">"今天天气真好"</span>&#125;</div><div class="line"><span class="keyword">print</span> json.dumps(hello,ensure_ascii=<span class="keyword">False</span>)</div><div class="line"></div><div class="line">output:</div><div class="line">&#123;<span class="string">"hi"</span>: <span class="string">"今天天气真好"</span>&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Py2的编码问题真是历史悠久，下边这个报错更是经常见到。&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;UnicodeDecodeError: &lt;span class=&quot;string&quot;&gt;&#39;ascii&#39;&lt;/span&gt; codec can&lt;span class=&quot;string&quot;&gt;&#39;t decode byte 0xe9 in position 2: ordinal not in range(128)&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在避开Py2的编码坑之前，我们需要了解一下一些常见的编码。&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://jianbing.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>命令行工具2.0版</title>
    <link href="http://jianbing.github.io/2016/07/11/cmd-tool/"/>
    <id>http://jianbing.github.io/2016/07/11/cmd-tool/</id>
    <published>2016-07-10T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.460Z</updated>
    
    <content type="html"><![CDATA[<h3 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h3><p>随着在工作中逐渐积累了不少测试脚本，需要对脚本们进行归类整合，目前发现3种可行方案：</p>
<ul>
<li>Web界面</li>
<li>GUI界面</li>
<li>命令行界面</li>
</ul>
<p>Web界面可以使用Flask框架来搭建，GUI界面可以使用TK，PyQT，wxPython等GUI库来编写，从学习成本来说，命令行界面是最容易上手，这一篇我们来聊一聊命令行界面的实现。</p>
<a id="more"></a>
<h3 id="整理需求"><a href="#整理需求" class="headerlink" title="整理需求"></a>整理需求</h3><p>我的需求其实还是比较简单的：</p>
<ul>
<li>多个命令可以随时调整顺序，方便在中间加入新的命令</li>
<li>支持快捷键操作</li>
<li>不需要做命令行参数解析，因为我都没打算用参数~偷笑~</li>
</ul>
<p>所以目前希望的运行效果是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">请选择指令</div><div class="line"></div><div class="line"><span class="number">1</span>，备份apk，hotkey:b</div><div class="line"><span class="number">2</span>，屏幕截图，hotkey:s</div><div class="line"><span class="number">3</span>，获取屏幕分辨率，hotkey:r</div><div class="line">Make a choice</div></pre></td></tr></table></figure>
<h3 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h3><p>其实，Python标准库里边，argparse可以用于解析命令行参数和选项。出色的第三方库有docopt，Click等。不过介于自己的需要并不复杂，那就造个轮子吧~</p>
<p>在之前，有写过一个<a href="https://github.com/jianbing/hexo-cmd-tool" target="_blank" rel="external">hexo-cmd-tool</a>，现在看起来使用方式还是麻烦了，于是基于它进行了改造。新增了一个装饰器cmdline来简化使用。</p>
<p>先看一个使用的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">from</span> utils.tools.cmd <span class="keyword">import</span> cmdline, CmdCenter</div><div class="line"></div><div class="line"><span class="meta">@cmdline('hexo generate', 'g')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hexo_g</span><span class="params">()</span>:</span></div><div class="line">    os.system(<span class="string">'hexo g'</span>)</div><div class="line"></div><div class="line"><span class="meta">@cmdline('hexo server', 's')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hexo_s</span><span class="params">()</span>:</span></div><div class="line">    os.system(<span class="string">'hexo s'</span>)</div><div class="line"></div><div class="line"><span class="meta">@cmdline('hexo version', 'v')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hexo_v</span><span class="params">()</span>:</span></div><div class="line">    os.system(<span class="string">'hexo v'</span>)</div><div class="line"></div><div class="line"><span class="meta">@cmdline('hexo deploy', 'd')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hexo_d</span><span class="params">()</span>:</span></div><div class="line">    os.system(<span class="string">'hexo d'</span>)</div><div class="line">	</div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    CmdCenter.work()</div></pre></td></tr></table></figure>
<p>使用效果：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">请选择指令</div><div class="line"></div><div class="line"><span class="number">1</span>，hexo generate，hotkey:g</div><div class="line"><span class="number">2</span>，hexo server，hotkey:s</div><div class="line"><span class="number">3</span>，hexo version，hotkey:v</div><div class="line"><span class="number">4</span>，hexo deploy，hotkey:d</div><div class="line">Make a choice</div></pre></td></tr></table></figure></p>
<p>原理非常简单，利用装饰器的特性，在加载函数对象的时候，把函数加多一层封装转存起来。</p>
<p>源码：</p>
<blockquote>
<p>开发环境：Python2.7+Win10+Pycharm</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</div><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">_Cmd</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func, title, hotkey=None, args=None)</span>:</span></div><div class="line">        self.__func = func</div><div class="line">        self.__title = title</div><div class="line">        self.__hotkey = hotkey</div><div class="line">        self.__args = args</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> self.__args:</div><div class="line">            self.__func(*self.__args)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            self.__func()</div><div class="line"></div><div class="line"><span class="meta">    @property</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hotkey</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.__hotkey</div><div class="line"></div><div class="line"><span class="meta">    @property</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">title</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.__title</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">_CmdCenter</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.cmds = OrderedDict()</div><div class="line">        self.cmds_hotkey = dict()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_cmd</span><span class="params">(self, cmd)</span>:</span></div><div class="line">        self.cmds[str(len(self.cmds) + <span class="number">1</span>)] = cmd</div><div class="line"></div><div class="line">        <span class="keyword">if</span> cmd.hotkey:</div><div class="line">            <span class="keyword">if</span> cmd.hotkey <span class="keyword">in</span> self.cmds_hotkey:</div><div class="line">                <span class="keyword">print</span> <span class="string">"\n热键冲突,&#123;0&#125;和&#123;1&#125;"</span>.format(cmd.title, self.cmds_hotkey[cmd.hotkey].title)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                self.cmds_hotkey[cmd.hotkey] = cmd</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_cmds</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> self.cmds:</div><div class="line">            <span class="keyword">print</span> <span class="string">'&#123;0&#125;，&#123;1&#125;，hotkey:&#123;2&#125;'</span>.format(key, self.cmds[key].title, self.cmds[key].hotkey)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_choice</span><span class="params">(self)</span>:</span></div><div class="line">        choice = raw_input(<span class="string">"Make a choice\n"</span>)</div><div class="line">        <span class="keyword">return</span> choice</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                <span class="keyword">print</span> <span class="string">'-'</span> * <span class="number">80</span></div><div class="line">                <span class="keyword">print</span> <span class="string">'请选择指令\n'</span></div><div class="line">                self.show_cmds()</div><div class="line"></div><div class="line">                <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">                    choice = self.get_choice()</div><div class="line">                    <span class="keyword">if</span> choice <span class="keyword">not</span> <span class="keyword">in</span> self.cmds <span class="keyword">and</span> choice <span class="keyword">not</span> <span class="keyword">in</span> self.cmds_hotkey:</div><div class="line">                        <span class="keyword">print</span> <span class="string">'选择错误，重新选择'</span></div><div class="line">                        <span class="keyword">continue</span></div><div class="line">                    <span class="keyword">break</span></div><div class="line"></div><div class="line">                <span class="keyword">print</span> <span class="string">''</span></div><div class="line"></div><div class="line">                <span class="keyword">if</span> choice <span class="keyword">in</span> self.cmds:</div><div class="line">                    self.cmds[choice].run()</div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    self.cmds_hotkey[choice].run()</div><div class="line">                <span class="keyword">print</span> <span class="string">'\n执行完成\n'</span></div><div class="line">            <span class="keyword">except</span> KeyboardInterrupt:</div><div class="line">                <span class="keyword">print</span> <span class="string">'手动退出'</span></div><div class="line"></div><div class="line">CmdCenter = _CmdCenter()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmdline</span><span class="params">(title, hotkey=None)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_cmdline</span><span class="params">(func)</span>:</span></div><div class="line">        CmdCenter.add_cmd(_Cmd(func, title, hotkey))</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__cmdline</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">            <span class="keyword">return</span> func(*args, **kwargs)</div><div class="line">        <span class="keyword">return</span> __cmdline</div><div class="line">    <span class="keyword">return</span> _cmdline</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;起源&quot;&gt;&lt;a href=&quot;#起源&quot; class=&quot;headerlink&quot; title=&quot;起源&quot;&gt;&lt;/a&gt;起源&lt;/h3&gt;&lt;p&gt;随着在工作中逐渐积累了不少测试脚本，需要对脚本们进行归类整合，目前发现3种可行方案：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Web界面&lt;/li&gt;
&lt;li&gt;GUI界面&lt;/li&gt;
&lt;li&gt;命令行界面&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Web界面可以使用Flask框架来搭建，GUI界面可以使用TK，PyQT，wxPython等GUI库来编写，从学习成本来说，命令行界面是最容易上手，这一篇我们来聊一聊命令行界面的实现。&lt;/p&gt;
    
    </summary>
    
    
      <category term="游戏测试" scheme="http://jianbing.github.io/tags/%E6%B8%B8%E6%88%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="python" scheme="http://jianbing.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Unity一键发版脚本折腾记（Windows版）</title>
    <link href="http://jianbing.github.io/2016/07/08/unity-auto-build-windows/"/>
    <id>http://jianbing.github.io/2016/07/08/unity-auto-build-windows/</id>
    <published>2016-07-07T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.529Z</updated>
    
    <content type="html"><![CDATA[<h3 id="脚本起源"><a href="#脚本起源" class="headerlink" title="脚本起源"></a>脚本起源</h3><p>策划：煎饼啊，给我一个最新的电脑版~<br>煎饼：好~</p>
<p>于是，开始手动发版，操作步骤如下：</p>
<ul>
<li>运行Unity，把平台切换到Windows</li>
<li>去到项目代码文件夹里边，先还原代码，再拉取最新代码</li>
<li>手动把测试模块拖动到主场景的Main Camera上</li>
<li>在工具面板点击打包资源按钮（开发提供）</li>
<li>在工具面板点击发版按钮（开发提供）</li>
</ul>
<p>偶尔会忘记拉取最新代码，偶尔会忘记打包资源，最重要的是，这发版步骤还是略繁琐，于是懒人症发作，开始探索如何脚本化这个过程。</p>
<a id="more"></a>
<h3 id="探索过程"><a href="#探索过程" class="headerlink" title="探索过程"></a>探索过程</h3><p>这些步骤分为两类操作。</p>
<p>一类是Unity外的操作，如还原，拉取代码，这个可以用Python解决。</p>
<p>一类是Unity内的操作，切换平台，打包资源，进行发版。这些操作，外部工具不好直接介入，最好的方式是Unity提供了命令行的操作形式，搜索了下，果然是有，研究了下，找到了几个可用的参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-batchmode  在批处理模式下运行，不会弹出Unity窗口</div><div class="line">-quit  其他命令执行完毕后将退出Unity编辑器</div><div class="line">-logFile &lt;pathname&gt;  指定输出Log文件</div><div class="line">-executeMethod &lt;ClassName.MethodName&gt;  在Unity启动的同时会执行指定的静态方法，注意，这个类所在文件目录，需要在Editor目录下（自己建一个Editor目录也行）</div></pre></td></tr></table></figure>
<p>最终调用命令如下:</p>
<blockquote>
<p>Unity.exe -quit -batchmode -executeMethod CMDTool.BuildWindows -logFile C:\build\log.log</p>
</blockquote>
<p>更多参数点击查看<a href="http://docs.unity3d.com/Manual/CommandLineArguments.html" target="_blank" rel="external">官方文档</a></p>
<h3 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h3><h4 id="Unity发版的工具类"><a href="#Unity发版的工具类" class="headerlink" title="Unity发版的工具类"></a>Unity发版的工具类</h4><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">using UnityEngine;</div><div class="line">using UnityEditor;</div><div class="line">using UnityEditor.SceneManagement;</div><div class="line">using Assets.Src.Editor.Toolkit.Tools;</div><div class="line"></div><div class="line">public class CMDTool &#123;</div><div class="line"></div><div class="line">    public static void BuildWindows() &#123;</div><div class="line">        SwitchPlatform(BuildTarget.StandaloneWindows);</div><div class="line">        CheckTestManager();</div><div class="line">        SGTools.BuildAssetBundles(EditorUserBuildSettings.activeBuildTarget, true);</div><div class="line">        SGTools.Build(EditorUserBuildSettings.activeBuildTarget);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void SwitchPlatform(BuildTarget target) &#123;</div><div class="line">        if (EditorUserBuildSettings.activeBuildTarget != target) &#123;</div><div class="line">            EditorUserBuildSettings.SwitchActiveBuildTarget(target);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void CheckTestManager() &#123;</div><div class="line">        EditorSceneManager.OpenScene("Assets/Scene/Main.unity");</div><div class="line">        if (GameObject.Find("Main Camera").GetComponent&lt;TestCenter.TestManager&gt;().IsNull()) &#123;</div><div class="line">            GameObject.Find("Main Camera").AddComponent&lt;TestCenter.TestManager&gt;();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>SwitchPlatform 切换平台<br>CheckTestManager 加载测试模块<br>SGTools.BuildAssetBundles 开发提供的打包资源方法<br>SGTools.Build  开发提供的发版方法</p>
<h4 id="还原，拉取项目代码"><a href="#还原，拉取项目代码" class="headerlink" title="还原，拉取项目代码"></a>还原，拉取项目代码</h4><p>为什么要还原？因为每次发版都会注入测试模块，下次发版前拉取新代码的时候，会出现冲突。</p>
<p>可以使用Python来调用Git命令：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_unity_code</span><span class="params">()</span>:</span></div><div class="line">    os.chdir(<span class="string">"C:\Project\sg"</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'start to reset'</span></div><div class="line">    os.system(<span class="string">"git reset --hard HEAD"</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'start to pull'</span></div><div class="line">    os.system(<span class="string">"git pull"</span>)</div></pre></td></tr></table></figure>
<h4 id="检查Unity是否已经关闭"><a href="#检查Unity是否已经关闭" class="headerlink" title="检查Unity是否已经关闭"></a>检查Unity是否已经关闭</h4><p>调用Unity命令行发版之前，需要确认Unity没有开启，否则运行会报错。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_unity_is_close</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">import</span> psutil</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> psutil.process_iter():</div><div class="line">        <span class="keyword">if</span> i.name() == <span class="string">"Unity.exe"</span>:</div><div class="line">            <span class="keyword">raise</span> Exception(<span class="string">"unity is not close"</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"unity is close"</span></div></pre></td></tr></table></figure></p>
<h4 id="检查发版的Log文件，是否有报错信息"><a href="#检查发版的Log文件，是否有报错信息" class="headerlink" title="检查发版的Log文件，是否有报错信息"></a>检查发版的Log文件，是否有报错信息</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">analyze_log</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'start to analyze log'</span></div><div class="line">    <span class="keyword">with</span> open(<span class="string">r"C:\build\log.log"</span>) <span class="keyword">as</span> f:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> f:</div><div class="line">            <span class="keyword">if</span> i.find(<span class="string">"error"</span>) &gt; <span class="number">-1</span>:</div><div class="line">                <span class="keyword">print</span> i</div></pre></td></tr></table></figure>
<h4 id="发版函数"><a href="#发版函数" class="headerlink" title="发版函数"></a>发版函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_windows</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'start to build windows'</span></div><div class="line">    os.chdir(<span class="string">r"C:\Program Files\Unity\Editor"</span>)</div><div class="line">    p = subprocess.Popen(<span class="string">r"Unity.exe -quit -batchmode -executeMethod CMDTool.BuildWindows -logFile C:\build\log.log"</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE)</div><div class="line">    stdout, stderr = p.communicate()</div><div class="line">	<span class="keyword">print</span> stdout</div><div class="line">	<span class="keyword">print</span> stderr</div><div class="line">    <span class="keyword">print</span> <span class="string">"result code is &#123;&#125;"</span>.format(p.returncode)</div></pre></td></tr></table></figure>
<h3 id="最终运行"><a href="#最终运行" class="headerlink" title="最终运行"></a>最终运行</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    start_time = time.time()</div><div class="line">    check_unity_is_close()</div><div class="line">    update_unity_code()</div><div class="line">    build_windows()</div><div class="line">    analyze_log()</div><div class="line">    <span class="keyword">print</span> <span class="string">'finish in &#123;&#125; seconds.'</span>.format(time.time() - start_time)</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;脚本起源&quot;&gt;&lt;a href=&quot;#脚本起源&quot; class=&quot;headerlink&quot; title=&quot;脚本起源&quot;&gt;&lt;/a&gt;脚本起源&lt;/h3&gt;&lt;p&gt;策划：煎饼啊，给我一个最新的电脑版~&lt;br&gt;煎饼：好~&lt;/p&gt;
&lt;p&gt;于是，开始手动发版，操作步骤如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;运行Unity，把平台切换到Windows&lt;/li&gt;
&lt;li&gt;去到项目代码文件夹里边，先还原代码，再拉取最新代码&lt;/li&gt;
&lt;li&gt;手动把测试模块拖动到主场景的Main Camera上&lt;/li&gt;
&lt;li&gt;在工具面板点击打包资源按钮（开发提供）&lt;/li&gt;
&lt;li&gt;在工具面板点击发版按钮（开发提供）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;偶尔会忘记拉取最新代码，偶尔会忘记打包资源，最重要的是，这发版步骤还是略繁琐，于是懒人症发作，开始探索如何脚本化这个过程。&lt;/p&gt;
    
    </summary>
    
    
      <category term="测试工具" scheme="http://jianbing.github.io/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>在Pycharm中配置autopep8</title>
    <link href="http://jianbing.github.io/2016/06/29/pycharm-autopep8/"/>
    <id>http://jianbing.github.io/2016/06/29/pycharm-autopep8/</id>
    <published>2016-06-28T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.501Z</updated>
    
    <content type="html"><![CDATA[<h3 id="关于PEP-8"><a href="#关于PEP-8" class="headerlink" title="关于PEP 8"></a>关于PEP 8</h3><p><a href="https://www.python.org/dev/peps/pep-0008/" target="_blank" rel="external">PEP 8</a>，Style Guide for Python Code，是Python官方推出的Python编码风格的约定，虽然这不是硬性的规定，但是如果Python程序员都尽量遵循这个文档，那么编码风格的统一会让代码的可读性大大提升。</p>
<p>在Pycharm里边默认也是有进行PEP8的检测，强迫症的人表示，看到代码中有黄色波浪线，就一定得先改好它。</p>
<a id="more"></a>
<h3 id="关于autopep8"><a href="#关于autopep8" class="headerlink" title="关于autopep8"></a>关于autopep8</h3><p>官网的描述是：</p>
<blockquote>
<p>autopep8 automatically formats Python code to conform to the PEP 8 style guide. It uses the pep8 utility to determine what parts of the code needs to be formatted. autopep8 is capable of fixing most of the formatting issues that can be reported by pep8.</p>
</blockquote>
<p>通过它，可以修复大部分PEP8工具中报告的代码排版问题。举个官网的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">example1</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment">####This is a long comment. This should be wrapped to fit within 72 characters.</span></div><div class="line">    some_tuple=(   <span class="number">1</span>,<span class="number">2</span>, <span class="number">3</span>,<span class="string">'a'</span>  );</div><div class="line">    some_variable=&#123;<span class="string">'long'</span>:<span class="string">'Long code lines should be wrapped within 79 characters.'</span>,</div><div class="line">    <span class="string">'other'</span>:[math.pi, <span class="number">100</span>,<span class="number">200</span>,<span class="number">300</span>,<span class="number">9876543210</span>,<span class="string">'This is a long string that goes on'</span>],</div><div class="line">    <span class="string">'more'</span>:&#123;<span class="string">'inner'</span>:<span class="string">'This whole logical line should be wrapped.'</span>,some_tuple:[<span class="number">1</span>,</div><div class="line">    <span class="number">20</span>,<span class="number">300</span>,<span class="number">40000</span>,<span class="number">500000000</span>,<span class="number">60000000000000000</span>]&#125;&#125;</div><div class="line">    <span class="keyword">return</span> (some_tuple, some_variable)</div></pre></td></tr></table></figure>
<p>这是一个比较极端情况的例子，在使用了autopep8自动修复后：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">example1</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># This is a long comment. This should be wrapped to fit within 72 characters.</span></div><div class="line">    some_tuple = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">'a'</span>)</div><div class="line">    some_variable = &#123;<span class="string">'long'</span>: <span class="string">'Long code lines should be wrapped within 79 characters.'</span>,</div><div class="line">                     <span class="string">'other'</span>: [math.pi, <span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>, <span class="number">9876543210</span>, <span class="string">'This is a long string that goes on'</span>],</div><div class="line">                     <span class="string">'more'</span>: &#123;<span class="string">'inner'</span>: <span class="string">'This whole logical line should be wrapped.'</span>, some_tuple: [<span class="number">1</span>,</div><div class="line">                                                                                                  <span class="number">20</span>, <span class="number">300</span>, <span class="number">40000</span>, <span class="number">500000000</span>, <span class="number">60000000000000000</span>]&#125;&#125;</div><div class="line">    <span class="keyword">return</span> (some_tuple, some_variable)</div></pre></td></tr></table></figure>
<p>是不是看起来焕然一新了？</p>
<h3 id="Pycharm中使用autopep8作为扩展工具"><a href="#Pycharm中使用autopep8作为扩展工具" class="headerlink" title="Pycharm中使用autopep8作为扩展工具"></a>Pycharm中使用autopep8作为扩展工具</h3><h4 id="安装autopep8"><a href="#安装autopep8" class="headerlink" title="安装autopep8"></a>安装autopep8</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install autopep8</div></pre></td></tr></table></figure>
<h4 id="Pycharm进行设置"><a href="#Pycharm进行设置" class="headerlink" title="Pycharm进行设置"></a>Pycharm进行设置</h4><ul>
<li>Settings–&gt;Tools–&gt;External Tools 点击添加按钮<ul>
<li>Name：autopep8（可以自定义）</li>
<li>Tools settings:</li>
<li>Programs：autopep8（不能修改）</li>
<li>Parameters：--in-place --aggressive --aggressive $FilePath$</li>
<li>Working directory：$ProjectFileDir$</li>
</ul>
</li>
<li>点击Output Files<ul>
<li>点击添加，名称可以任意填写</li>
<li>Regular expression to match output：$FILE_PATH$\:$LINE$\:$COLUMN$\:.*</li>
</ul>
</li>
</ul>
<h4 id="实际使用"><a href="#实际使用" class="headerlink" title="实际使用"></a>实际使用</h4><p>在右击上代码–&gt;External Tool–&gt;autopep8</p>
<p>Pycharm自动调用了autopep8对当前文件进行PEP8优化。</p>
<h3 id="autopep8的一些设置点"><a href="#autopep8的一些设置点" class="headerlink" title="autopep8的一些设置点"></a>autopep8的一些设置点</h3><p>在上边说到，在Parameters的设置是:--in-place --aggressive --aggressive $FilePath$</p>
<p>–in-place 代表会直接修改源文件</p>
<p>–aggressive autopep8默认只修复空白，对齐相关的PEP8问题，加入--aggressive设置，会增加修复如 x == None 修复为 x is None，{“a”: 1, “b”: 2}.has_key(‘a’) 修复为’a’ in {“a”: 1, “b”: 2}</p>
<p>–ignore  忽略PEP8检查项</p>
<p>因为我只打算用autopep8来修复空格，空行这一类的排版问题，同时要忽略每一行长度过长的检测（E501 - Try to make lines fit within –max-line-length characters.），所以最终设置是：</p>
<p>--in-place   --ignore=E501  $FilePath$ </p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;关于PEP-8&quot;&gt;&lt;a href=&quot;#关于PEP-8&quot; class=&quot;headerlink&quot; title=&quot;关于PEP 8&quot;&gt;&lt;/a&gt;关于PEP 8&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://www.python.org/dev/peps/pep-0008/&quot;&gt;PEP 8&lt;/a&gt;，Style Guide for Python Code，是Python官方推出的Python编码风格的约定，虽然这不是硬性的规定，但是如果Python程序员都尽量遵循这个文档，那么编码风格的统一会让代码的可读性大大提升。&lt;/p&gt;
&lt;p&gt;在Pycharm里边默认也是有进行PEP8的检测，强迫症的人表示，看到代码中有黄色波浪线，就一定得先改好它。&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://jianbing.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>游戏自动化测试之辅助工具篇</title>
    <link href="http://jianbing.github.io/2016/06/13/game-test-automation-1/"/>
    <id>http://jianbing.github.io/2016/06/13/game-test-automation-1/</id>
    <published>2016-06-12T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.472Z</updated>
    
    <content type="html"><![CDATA[<p>说到游戏的自动化测试，很多人脑海中第一个浮现出来的词语，我想是UI自动化和接口自动化这两个的其中之一吧。</p>
<blockquote>
<p>自动化测试是把以人为驱动的测试行为转化为机器执行的一种过程。</p>
</blockquote>
<p>除了UI和接口自动化测试，我们也可以将测试工作中的重复性内容，编写成脚本或工具，可以反复使用，提升工作的效率。</p>
<p>今天就来聊一聊测试辅助工具的开发吧。</p>
<a id="more"></a>
<h3 id="懒人思维"><a href="#懒人思维" class="headerlink" title="懒人思维"></a>懒人思维</h3><p>首次，要做一个“懒测试”。对于工作中的重复性内容，不能一味地允许自己重复再重复，我们需要解放自己的双手，更高效地完成工作任务。</p>
<p>通过分析重复性工作是否可以形成规律性的步骤，开始编写测试工具脚本，首先网上搜索是否已经有靠谱的解决方案（毕竟重复造轮子也是对时间的消耗），如果有，直接用即可，如果没有，那就自己造轮子呗。</p>
<p>对测试脚本的公共功能抽取出来，封装后加入到公共测试库里边，方便之后的复用。</p>
<h3 id="编程语言的选择"><a href="#编程语言的选择" class="headerlink" title="编程语言的选择"></a>编程语言的选择</h3><p>其实主流语言都是不错的选择，用自己熟悉的语言即可。</p>
<p>权衡之下，我选择了Python，主要原因有以下几点：</p>
<ul>
<li><p>容易上手，在测试人员之间更容易推广。</p>
</li>
<li><p>强悍的标准库和海量的第三方库，想到的实现方式往往已经有成熟的轮子了。</p>
</li>
<li><p>和编译型语言相比，相同的功能少写好多代码，开发效率高。</p>
</li>
<li><p>Python作为一门出色的胶水语言，可以和C#，java联合使用。</p>
</li>
</ul>
<h3 id="实践起来"><a href="#实践起来" class="headerlink" title="实践起来"></a>实践起来</h3><p>举几个例子吧。</p>
<h4 id="查看内网发版时间"><a href="#查看内网发版时间" class="headerlink" title="查看内网发版时间"></a>查看内网发版时间</h4><p>有时候问开发，最近一次内网服务端发版是什么时候？开发回答：有点忘记了。。</p>
<p>那就得自力更生了~</p>
<p>原始方式：使用FTP软件连入内网服务器，查看文件的更新日期，从而知道发版时间。</p>
<p>懒人方式：那就写个脚本吧。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sftp = SFTPClient(host=<span class="string">"192.168.1.10"</span>, port=<span class="number">22</span>, user=<span class="string">"root"</span>, pwd=<span class="string">"XXXXXX"</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">"内网发版时间是：&#123;&#125;"</span>.format(sftp.get_file_update_time(path=<span class="string">'/data/www/sg/sg_dev/socket/conf/config/treasure'</span>))</div><div class="line">sftp.close()</div></pre></td></tr></table></figure>
<p>SFTPClient<a href="https://github.com/jianbing/utils/blob/master/tools/sftpclient.py" target="_blank" rel="external">点击查看源码</a></p>
<h4 id="批量更新SVN目录"><a href="#批量更新SVN目录" class="headerlink" title="批量更新SVN目录"></a>批量更新SVN目录</h4><p>有2个常用的SVN目录，一个策划文档目录，一个配置表目录，每天来到公司，都需要，先Revert，再Update。</p>
<p>懒人方式：几行代码实现批量操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</div><div class="line"><span class="keyword">import</span> subprocess</div><div class="line">subprocess.Popen(<span class="string">r'TortoiseProc.exe /command:revert /path:"E:\策划文档" /closeonend:0'</span>.encode(<span class="string">'gb2312'</span>))</div><div class="line">subprocess.Popen(<span class="string">r'TortoiseProc.exe /command:revert /path:"E:\配置文档" /closeonend:0'</span>.encode(<span class="string">'gb2312'</span>))</div><div class="line">subprocess.Popen(<span class="string">r'TortoiseProc.exe /command:update /path:"E:\策划文档" /closeonend:0'</span>.encode(<span class="string">'gb2312'</span>))</div><div class="line">subprocess.Popen(<span class="string">r'TortoiseProc.exe /command:update /path:"E:\配置文档" /closeonend:0'</span>.encode(<span class="string">'gb2312'</span>))</div></pre></td></tr></table></figure>
<h4 id="之前分享的一些例子"><a href="#之前分享的一些例子" class="headerlink" title="之前分享的一些例子"></a>之前分享的一些例子</h4><ul>
<li><p><a href="http://jianbing.github.io/2016/06/06/unity-pic-check/">Unity图片压缩设置批量检查</a></p>
</li>
<li><p><a href="http://jianbing.github.io/2016/03/08/check-player-name/">测试游戏取名库</a></p>
</li>
<li><p><a href="http://jianbing.github.io/2016/03/05/search-content-in-files/">在文件夹内查找指定文本</a></p>
</li>
<li><p><a href="http://jianbing.github.io/2016/04/27/adb-tool/">ADB工具类分享</a></p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;说到游戏的自动化测试，很多人脑海中第一个浮现出来的词语，我想是UI自动化和接口自动化这两个的其中之一吧。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;自动化测试是把以人为驱动的测试行为转化为机器执行的一种过程。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;除了UI和接口自动化测试，我们也可以将测试工作中的重复性内容，编写成脚本或工具，可以反复使用，提升工作的效率。&lt;/p&gt;
&lt;p&gt;今天就来聊一聊测试辅助工具的开发吧。&lt;/p&gt;
    
    </summary>
    
    
      <category term="测试工具" scheme="http://jianbing.github.io/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>Unity图片压缩设置批量检查</title>
    <link href="http://jianbing.github.io/2016/06/06/unity-pic-check/"/>
    <id>http://jianbing.github.io/2016/06/06/unity-pic-check/</id>
    <published>2016-06-05T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.534Z</updated>
    
    <content type="html"><![CDATA[<h3 id="检查点整理"><a href="#检查点整理" class="headerlink" title="检查点整理"></a>检查点整理</h3><p>合理的设置可以减少内存的占用，以我们游戏的安卓平台为例：</p>
<ul>
<li>美术输出的图片资源，分辨率最大不超过1024*1024</li>
<li>在Unity中，Max Size设置为1024</li>
<li>Format设置为Compressed</li>
<li>Compression Quality设置为Best</li>
<li>勾选Compress using ETC1</li>
</ul>
<a id="more"></a>
<h3 id="脚本实现"><a href="#脚本实现" class="headerlink" title="脚本实现"></a>脚本实现</h3><blockquote>
<p>开发环境：Python2.7+Win10+Pycharm</p>
<p>美术输出的图片资源，分辨率最大不超过1024*1024</p>
</blockquote>
<p>这一项可以使用Python的Pillow库，来获取图片的分辨率。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_files_by_suffix</span><span class="params">(path, suffixes=<span class="params">(<span class="string">"txt"</span>, <span class="string">"xml"</span>)</span>)</span>:</span></div><div class="line">    file_list = []</div><div class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(path):</div><div class="line">        <span class="keyword">for</span> afile <span class="keyword">in</span> files:</div><div class="line">            file_suffix = os.path.splitext(afile)[<span class="number">1</span>][<span class="number">1</span>:].lower()   </div><div class="line">            <span class="keyword">if</span> file_suffix <span class="keyword">in</span> suffixes:</div><div class="line">                file_list.append(os.path.join(root, afile))</div><div class="line">    <span class="keyword">return</span> file_list</div><div class="line"></div><div class="line">pic = get_files_by_suffix(<span class="string">"C:\Project\sg\sg\Assets\Res\zh-CN"</span>, (<span class="string">'jpg'</span>, <span class="string">'png'</span>))</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> pic:</div><div class="line">    <span class="keyword">print</span> i</div><div class="line">    p = Image.open(i)</div><div class="line">    x, y = p.size</div><div class="line">    p.close()</div><div class="line">    <span class="keyword">if</span> x != y:</div><div class="line">        <span class="keyword">print</span> <span class="string">'size不相等&#123;&#125;*&#123;&#125;'</span>.format(x, y)</div><div class="line">    <span class="keyword">if</span> x &gt; <span class="number">1024</span> <span class="keyword">or</span> y &gt; <span class="number">1024</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'size大于1024'</span></div></pre></td></tr></table></figure>
<blockquote>
<p>在Unity中，Max Size设置为1024<br>Format设置为Compressed<br>Compression Quality设置为Best<br>勾选Compress using ETC1</p>
</blockquote>
<p>这里可以有两种实现方式：</p>
<h4 id="Python方式"><a href="#Python方式" class="headerlink" title="Python方式"></a>Python方式</h4><p>通过读取图片的meta文件，检查文件中的以下设置是否正确。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- buildTarget: Android</div><div class="line">    maxTextureSize: <span class="number">2048</span></div><div class="line">    textureFormat: <span class="number">-1</span></div><div class="line">    compressionQuality: <span class="number">100</span></div><div class="line">    allowsAlphaSplitting: <span class="number">0</span></div></pre></td></tr></table></figure>
<h4 id="C-方式"><a href="#C-方式" class="headerlink" title="C#方式"></a>C#方式</h4><p>通过Unity的api，读取相应的设置，进行检查。核心代码如下：</p>
<p>pic变量是图片的路径，如 @”Assets/Res/zh-CN/Battle/Texture/BG/BG_001.jpg”</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">TextureImporter ti = AssetImporter.GetAtPath(pic) <span class="keyword">as</span> TextureImporter;</div><div class="line">int maxSize = <span class="number">0</span>;</div><div class="line">TextureImporterFormat format;</div><div class="line">int compressionQuality = <span class="number">0</span>;</div><div class="line">ti.GetPlatformTextureSettings(<span class="string">"Android"</span>, out maxSize, out format, out compressionQuality);</div><div class="line"></div><div class="line">Debug.LogWarning(string.Format(<span class="string">"strat to check &#123;0&#125;"</span>,pic));</div><div class="line"></div><div class="line">    </div><div class="line"><span class="keyword">if</span> (maxSize != <span class="number">1024</span>) &#123;</div><div class="line">    Debug.LogError(string.Format(<span class="string">"&#123;0&#125;,max size is not 1024,now is &#123;1&#125;"</span>, pic, maxSize));</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span>(format != TextureImporterFormat.AutomaticCompressed) &#123;</div><div class="line">    Debug.LogError(string.Format(<span class="string">"&#123;0&#125;,format is not compressed,now is &#123;1&#125;"</span>, pic, format));</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (compressionQuality != <span class="number">100</span>) &#123;</div><div class="line">    Debug.LogError(string.Format(<span class="string">"&#123;0&#125;,compression quality is not best,now is &#123;1&#125;"</span>, pic, compressionQuality.ToString()));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span>(pic.ToLower().IndexOf(<span class="string">"png"</span>) &gt; <span class="number">-1</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (!ti.GetAllowsAlphaSplitting()) &#123;</div><div class="line">        Debug.LogError(string.Format(<span class="string">"&#123;0&#125;,compress using ETC1 is not true"</span>, pic));</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;检查点整理&quot;&gt;&lt;a href=&quot;#检查点整理&quot; class=&quot;headerlink&quot; title=&quot;检查点整理&quot;&gt;&lt;/a&gt;检查点整理&lt;/h3&gt;&lt;p&gt;合理的设置可以减少内存的占用，以我们游戏的安卓平台为例：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;美术输出的图片资源，分辨率最大不超过1024*1024&lt;/li&gt;
&lt;li&gt;在Unity中，Max Size设置为1024&lt;/li&gt;
&lt;li&gt;Format设置为Compressed&lt;/li&gt;
&lt;li&gt;Compression Quality设置为Best&lt;/li&gt;
&lt;li&gt;勾选Compress using ETC1&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="测试工具" scheme="http://jianbing.github.io/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>在Python中使用Sikuli</title>
    <link href="http://jianbing.github.io/2016/05/21/sikuli-tool/"/>
    <id>http://jianbing.github.io/2016/05/21/sikuli-tool/</id>
    <published>2016-05-20T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.522Z</updated>
    
    <content type="html"><![CDATA[<h3 id="关于Sikuli"><a href="#关于Sikuli" class="headerlink" title="关于Sikuli"></a>关于Sikuli</h3><p>Sikuli 是由 MIT 的研究团队发布的新型图形化编程技术。它以图像检索技术为基础，提供了一套基于 Jython 的脚本语言以及集成开发环境。使用者可利用屏幕截图直接引用 GUI 元素进行编程，完成交互操作。Sikuli 一词取自墨西哥 Huichol Indian 土著语，意为“上帝之眼”， Sikuli 让电脑能像人一样“看”这个“真实世界”。</p>
<p>通过Sikuli自带的IDE，操作简单，容易上手，可以编写出非常具备可读性的代码。</p>
<p><img src="/images/sikuli-tool/sikuli.png" alt=""></p>
<p>使用起来，也有一些不足：</p>
<ul>
<li>没有代码提示，要一边翻看api，一边写</li>
<li>调试功能比较弱</li>
<li>无法在现有的代码里边，直接集成sikuli的功能</li>
</ul>
<a id="more"></a>
<p>也试过用Eclipse+Pydev来导入sikuli的jar包，使用jython驱动，但因为现有的代码都是在python下编写的，所以这个方式虽然可以脱离Sikuli的IDE，但是并不理想。</p>
<h3 id="Sikuli-in-Python"><a href="#Sikuli-in-Python" class="headerlink" title="Sikuli in Python"></a>Sikuli in Python</h3><p>直到前几天逛Github，发现了<a href="https://github.com/kevlened/sikuli_cpython" target="_blank" rel="external">sikuli_cpython</a>这个项目，启发了我，原理是<a href="https://github.com/kivy/pyjnius" target="_blank" rel="external">pyjnius</a>提供了可以从Python中直接访问java类的功能，通过它，实现了对Sikuli的jar包的一层封装。</p>
<p>先看看pyjnius的一个官方例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt;<span class="keyword">from</span> jnius <span class="keyword">import</span> autoclass</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>autoclass(<span class="string">'java.lang.System'</span>).out.println(<span class="string">'Hello world'</span>)</div><div class="line">Hello world</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Stack = autoclass(<span class="string">'java.util.Stack'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>stack = Stack()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>stack.push(<span class="string">'hello'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>stack.push(<span class="string">'world'</span>)</div><div class="line">&gt;&gt;&gt;<span class="keyword">print</span> stack.pop()</div><div class="line">world</div><div class="line">&gt;&gt;&gt;<span class="keyword">print</span> stack.pop()</div><div class="line">hello</div></pre></td></tr></table></figure>
<p>开始动手~</p>
<blockquote>
<p>开发环境：Python2.7+Win10+Pycharm</p>
</blockquote>
<h3 id="相关依赖"><a href="#相关依赖" class="headerlink" title="相关依赖"></a>相关依赖</h3><ul>
<li>Cython</li>
<li>pyjnius</li>
<li>JDK</li>
</ul>
<blockquote>
<p>环境变量需要配置JAVA_HOME</p>
</blockquote>
<p><img src="/images/sikuli-tool/java_home.png" alt=""></p>
<blockquote>
<p>Path里边，需要加入jvm.dll所在目录</p>
</blockquote>
<p><img src="/images/sikuli-tool/path.png" alt=""></p>
<h3 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h3><blockquote>
<p>例子1：把图标拖动到文件夹中，最后高亮这个文件夹，并双击它。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sikulitool.sikuli <span class="keyword">import</span> *</div><div class="line"></div><div class="line">s = Screen()</div><div class="line">s.dragDrop(<span class="string">"as.png"</span>, <span class="string">"dir.png"</span>)</div><div class="line">s.sleep(<span class="number">0.5</span>)</div><div class="line">s.dragDrop(<span class="string">"qq.png"</span>, <span class="string">"dir.png"</span>)</div><div class="line">s.find(<span class="string">"dir.png"</span>).highlight().sleep(<span class="number">1</span>).doubleClick()</div></pre></td></tr></table></figure>
<p><img src="/images/sikuli-tool/drag.gif" alt=""></p>
<blockquote>
<p>例子2：通过similar方法设置相似度，默认是0.7，在屏幕中查找多个相似度为50%的对象，并依次高亮，移动到上边。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sikulitool.sikuli <span class="keyword">import</span> *</div><div class="line"></div><div class="line">s = Screen()</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s.findAll(Pattern(<span class="string">'doc.png'</span>).similar(<span class="number">0.5</span>)):</div><div class="line">    i.highlight().sleep(<span class="number">1</span>).hover()</div></pre></td></tr></table></figure>
<p><img src="/images/sikuli-tool/findall.gif" alt=""></p>
<p>源码已在<a href="https://github.com/jianbing/sikulitool" target="_blank" rel="external">Github</a>，欢迎围观~</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;关于Sikuli&quot;&gt;&lt;a href=&quot;#关于Sikuli&quot; class=&quot;headerlink&quot; title=&quot;关于Sikuli&quot;&gt;&lt;/a&gt;关于Sikuli&lt;/h3&gt;&lt;p&gt;Sikuli 是由 MIT 的研究团队发布的新型图形化编程技术。它以图像检索技术为基础，提供了一套基于 Jython 的脚本语言以及集成开发环境。使用者可利用屏幕截图直接引用 GUI 元素进行编程，完成交互操作。Sikuli 一词取自墨西哥 Huichol Indian 土著语，意为“上帝之眼”， Sikuli 让电脑能像人一样“看”这个“真实世界”。&lt;/p&gt;
&lt;p&gt;通过Sikuli自带的IDE，操作简单，容易上手，可以编写出非常具备可读性的代码。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/sikuli-tool/sikuli.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;使用起来，也有一些不足：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;没有代码提示，要一边翻看api，一边写&lt;/li&gt;
&lt;li&gt;调试功能比较弱&lt;/li&gt;
&lt;li&gt;无法在现有的代码里边，直接集成sikuli的功能&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://jianbing.github.io/tags/python/"/>
    
      <category term="测试工具" scheme="http://jianbing.github.io/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>用Python制作一个迷你快捷键工具</title>
    <link href="http://jianbing.github.io/2016/05/13/mini-hotkey-tool/"/>
    <id>http://jianbing.github.io/2016/05/13/mini-hotkey-tool/</id>
    <published>2016-05-12T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.492Z</updated>
    
    <content type="html"><![CDATA[<h3 id="工具起源"><a href="#工具起源" class="headerlink" title="工具起源"></a>工具起源</h3><p>有时候在群里看到一个新鲜的名词，想要搜索一下是个什么东东，一般流程是：复制文本，打开浏览器，粘贴到搜索框，回车。</p>
<p>有时候看到一个电影名称，想快速在豆瓣电影看下评分，一般流程是：复制文本，打开豆瓣电影，粘贴，点击搜索。</p>
<p>在记录bug的时候，需要把截图拖动到上传控件上，经常需要在屏幕下方一堆已经打开的文件夹中，找到截图的文件夹。</p>
<p>如果这些事情，可以用快捷键来快速完成就好了。于是开始查找资料~</p>
<a id="more"></a>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p>通过对鼠标和键盘事件的监控，如果按下的组合键满足已经设置的快捷键组合，就执行指定的函数代码。</p>
<h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>需要安装以下的库：</p>
<ul>
<li><a href="https://sourceforge.net/projects/pywin32/files/pywin32/" target="_blank" rel="external">pywin32</a></li>
<li><a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#pyhook" target="_blank" rel="external">pyhook</a></li>
<li><a href="https://github.com/schurpf/pyhk" target="_blank" rel="external">pyhk</a></li>
<li>pyperclip，查看剪贴板数据，通过pip安装即可</li>
</ul>
<h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><blockquote>
<p>开发环境：Python2.7+Win10+Pycharm</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"><span class="keyword">from</span> pyhk <span class="keyword">import</span> pyhk</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> subprocess</div><div class="line"><span class="keyword">import</span> pyperclip</div><div class="line"></div><div class="line">CONST_LIEBAO_DIR = <span class="string">r"C:\Users\Bing\AppData\Local\liebao\liebao.exe"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">open_shot_dir</span><span class="params">()</span>:</span></div><div class="line">    os.system(<span class="string">r"start  C:\Users\Bing\Desktop\shot"</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_douban_movie</span><span class="params">()</span>:</span></div><div class="line">    copy_str = pyperclip.paste().strip()</div><div class="line">    subprocess.Popen((<span class="string">'&#123;0&#125; https://movie.douban.com/subject_search?search_text=&#123;1&#125;'</span>.format(CONST_LIEBAO_DIR, copy_str.encode(<span class="string">'gb2312'</span>))))</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_baidu</span><span class="params">()</span>:</span></div><div class="line">    copy_str = pyperclip.paste().strip()</div><div class="line">    subprocess.Popen((<span class="string">'&#123;0&#125; https://www.baidu.com/s?wd=&#123;1&#125;'</span>.format(CONST_LIEBAO_DIR, copy_str.encode(<span class="string">'gb2312'</span>))))</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    <span class="keyword">print</span> <span class="string">"start working"</span></div><div class="line">    hot = pyhk()</div><div class="line">    hot.addHotkey([<span class="string">'mouse left'</span>, <span class="string">'S'</span>], open_shot_dir)</div><div class="line">    hot.addHotkey([<span class="string">'mouse left'</span>, <span class="string">'D'</span>], search_douban_movie)</div><div class="line">    hot.addHotkey([<span class="string">'mouse left'</span>, <span class="string">'B'</span>], search_baidu)</div><div class="line">    hot.start()</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;工具起源&quot;&gt;&lt;a href=&quot;#工具起源&quot; class=&quot;headerlink&quot; title=&quot;工具起源&quot;&gt;&lt;/a&gt;工具起源&lt;/h3&gt;&lt;p&gt;有时候在群里看到一个新鲜的名词，想要搜索一下是个什么东东，一般流程是：复制文本，打开浏览器，粘贴到搜索框，回车。&lt;/p&gt;
&lt;p&gt;有时候看到一个电影名称，想快速在豆瓣电影看下评分，一般流程是：复制文本，打开豆瓣电影，粘贴，点击搜索。&lt;/p&gt;
&lt;p&gt;在记录bug的时候，需要把截图拖动到上传控件上，经常需要在屏幕下方一堆已经打开的文件夹中，找到截图的文件夹。&lt;/p&gt;
&lt;p&gt;如果这些事情，可以用快捷键来快速完成就好了。于是开始查找资料~&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://jianbing.github.io/tags/python/"/>
    
      <category term="测试工具" scheme="http://jianbing.github.io/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>Unity游戏内显示报错信息</title>
    <link href="http://jianbing.github.io/2016/05/07/unity-show-error-tool/"/>
    <id>http://jianbing.github.io/2016/05/07/unity-show-error-tool/</id>
    <published>2016-05-06T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.537Z</updated>
    
    <content type="html"><![CDATA[<p>忙碌的五月份开始咯~最近刚好做了一个Unity的显示报错工具，就分享出来吧~</p>
<h3 id="工具起源"><a href="#工具起源" class="headerlink" title="工具起源"></a>工具起源</h3><p>Unity游戏导出的PC版本，默认情况下是看不到报错信息的，为了方便测试人员查看报错信息，定位Bug的归属，于是有了下边这个小工具。</p>
<p>先看效果图吧。</p>
<a id="more"></a>
<p><img src="/images/unity-show-error-tool/pic1.png" alt=""></p>
<p>可以设置开始监听，停止监听，清空记录。</p>
<p>可以查看到报错的详细堆栈信息。</p>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p>简单来说，是这样的~</p>
<ul>
<li><p>Unity提供了一个事件，Application.logMessageReceived，可以在接收到log信息的时候触发自定义log处理函数。</p>
</li>
<li><p>在log处理函数里边，将log存储起来。</p>
</li>
<li><p>制作一个窗口，负责显示已经存储的log信息。</p>
</li>
</ul>
<p>直接上代码吧~</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line">using System.Collections.Generic;</div><div class="line">using UnityEngine;</div><div class="line"></div><div class="line">namespace TestCenter.Utils &#123;</div><div class="line"></div><div class="line">    public class ShowError : MonoBehaviour &#123;</div><div class="line"></div><div class="line">        static List&lt;string&gt; ErrorMsgs = new List&lt;string&gt;();</div><div class="line">        bool ShowWindow = false;</div><div class="line">        bool Record = false;</div><div class="line">        Rect UIRect = new Rect(0, Screen.height / 2, Screen.width, Screen.height / 2);</div><div class="line">        Vector2 ScrollPosition = Vector2.zero;</div><div class="line"></div><div class="line">        void Start() &#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        void OnGUI() &#123;</div><div class="line"></div><div class="line">            if (ShowWindow) &#123;</div><div class="line">                if (GUI.Button(new Rect(0, (Screen.height / 3 + 90), 50, 30), &quot;隐藏&quot;)) &#123;</div><div class="line">                    ShowWindow = false;</div><div class="line">                &#125;</div><div class="line">            &#125; else &#123;</div><div class="line">                if (GUI.Button(new Rect(0, (Screen.height / 3 + 90), 50, 30), &quot;显示&quot;)) &#123;</div><div class="line">                    ShowWindow = true;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if (ShowWindow) &#123;</div><div class="line">                UIRect = GUI.Window(1, UIRect, ErrorWindowFunc, &quot;Log监听&quot;);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        void ErrorWindowFunc(int windowID) &#123;</div><div class="line"></div><div class="line">            GUI.DragWindow(new Rect(0, 0, UIRect.width, 30));</div><div class="line">            GUI.Box(new Rect(0, 0, UIRect.width, UIRect.height), &quot;&quot;);</div><div class="line">            GUILayout.BeginArea(new Rect(5, 20, UIRect.width - 10, UIRect.height));</div><div class="line"></div><div class="line">            ScrollPosition = GUILayout.BeginScrollView(ScrollPosition, GUILayout.Width(UIRect.width - 10), GUILayout.Height(UIRect.height - 60));</div><div class="line">            GUILayout.BeginVertical();</div><div class="line"></div><div class="line">            foreach (var Log in ErrorMsgs) &#123;</div><div class="line">                GUILayout.Label(Log);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            GUILayout.EndVertical();</div><div class="line">            GUILayout.EndScrollView();</div><div class="line"></div><div class="line">            GUILayout.BeginHorizontal();</div><div class="line"></div><div class="line"></div><div class="line">            if (Record) &#123;</div><div class="line">                if (GUILayout.Button(&quot;停止监听&quot;)) &#123;</div><div class="line">                    Application.logMessageReceived -= HandleLog;</div><div class="line">                    Record = false;</div><div class="line">                &#125;</div><div class="line">            &#125; else &#123;</div><div class="line">                if (GUILayout.Button(&quot;监听Log&quot;)) &#123;</div><div class="line">                    Application.logMessageReceived += HandleLog;</div><div class="line">                    Record = true;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if (GUILayout.Button(&quot;清空记录&quot;)) &#123;</div><div class="line">                ErrorMsgs.Clear();</div><div class="line">            &#125;</div><div class="line">            GUILayout.EndHorizontal();</div><div class="line"></div><div class="line">            GUILayout.EndArea();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        void Update() &#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        void HandleLog(string log, string trace, LogType type) &#123;</div><div class="line">            if (type.Equals(LogType.Error) || type.Equals(LogType.Exception)) &#123;</div><div class="line">                ErrorMsgs.Add(log);</div><div class="line">                ErrorMsgs.Add(trace);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>将脚本直接挂在主场景的Main Camera即可使用，源码已在<a href="https://github.com/jianbing/UnityTestTool" target="_blank" rel="external">Github</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;忙碌的五月份开始咯~最近刚好做了一个Unity的显示报错工具，就分享出来吧~&lt;/p&gt;
&lt;h3 id=&quot;工具起源&quot;&gt;&lt;a href=&quot;#工具起源&quot; class=&quot;headerlink&quot; title=&quot;工具起源&quot;&gt;&lt;/a&gt;工具起源&lt;/h3&gt;&lt;p&gt;Unity游戏导出的PC版本，默认情况下是看不到报错信息的，为了方便测试人员查看报错信息，定位Bug的归属，于是有了下边这个小工具。&lt;/p&gt;
&lt;p&gt;先看效果图吧。&lt;/p&gt;
    
    </summary>
    
    
      <category term="游戏测试" scheme="http://jianbing.github.io/tags/%E6%B8%B8%E6%88%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="测试工具" scheme="http://jianbing.github.io/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>使用Next主题遇到的一个坑</title>
    <link href="http://jianbing.github.io/2016/04/30/set-up-next/"/>
    <id>http://jianbing.github.io/2016/04/30/set-up-next/</id>
    <published>2016-04-29T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.516Z</updated>
    
    <content type="html"><![CDATA[<p>昨天晚上睡前，打算把博客的主题，替换成Next，<a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="external">Next的Github地址</a>。</p>
<p>对着Next的使用文档就开始进行配置，到了最终执行Hexo g来生成博客文章的时候，报错了！！</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Unhandled rejection Error: ENOENT: no such file <span class="keyword">or</span> directory, open <span class="string">'C:\github\blog\themes\next\layout\_scripts\schemes\.swig'</span></div><div class="line">    at Error (native)</div><div class="line">    at Object.fs.openSync (fs.js:<span class="number">584</span>:<span class="number">18</span>)</div><div class="line">    at Object.fs.readFileSync (fs.js:<span class="number">431</span>:<span class="number">33</span>)</div><div class="line">    at Object.ret.load (C:\github\blog\node_modules\swig\lib\loaders\filesystem.js:<span class="number">55</span>:<span class="number">15</span>)</div><div class="line">    at compileFile (C:\github\blog\node_modules\swig\lib\swig.js:<span class="number">695</span>:<span class="number">31</span>)</div><div class="line">    at Object.eval [<span class="keyword">as</span> tpl] (eval at &lt;anonymous&gt; (C:\github\blog\node_modules\swig\lib\swig.js:<span class="number">498</span>:<span class="number">13</span>), &lt;anonymous&gt;:<span class="number">293</span>:<span class="number">18</span>)</div><div class="line">    at compiled [<span class="keyword">as</span> _compiledSync] (C:\github\blog\node_modules\swig\lib\swig.js:<span class="number">619</span>:<span class="number">18</span>)</div><div class="line">    at tryCatcher (C:\github\blog\node_modules\bluebird\js\release\util.js:<span class="number">16</span>:<span class="number">23</span>)</div><div class="line">    at null._compiled (C:\github\blog\node_modules\bluebird\js\release\method.js:<span class="number">15</span>:<span class="number">34</span>)</div><div class="line">    at View.render (C:\github\blog\node_modules\hexo\lib\theme\view.js:<span class="number">29</span>:<span class="number">15</span>)</div><div class="line">    at C:\github\blog\node_modules\hexo\lib\hexo\index.js:<span class="number">387</span>:<span class="number">25</span></div><div class="line">    at tryCatcher (C:\github\blog\node_modules\bluebird\js\release\util.js:<span class="number">16</span>:<span class="number">23</span>)</div><div class="line">    at C:\github\blog\node_modules\bluebird\js\release\method.js:<span class="number">15</span>:<span class="number">34</span></div><div class="line">    at RouteStream._read (C:\github\blog\node_modules\hexo\lib\hexo\router.js:<span class="number">134</span>:<span class="number">3</span>)</div><div class="line">    at RouteStream.Readable.read (_stream_readable.js:<span class="number">336</span>:<span class="number">10</span>)</div><div class="line">    at resume_ (_stream_readable.js:<span class="number">726</span>:<span class="number">12</span>)</div><div class="line">    at _combinedTickCallback (node.js:<span class="number">383</span>:<span class="number">13</span>)</div><div class="line">    at process._tickCallback (node.js:<span class="number">407</span>:<span class="number">11</span>)</div></pre></td></tr></table></figure>
<p>no such file or directory？？</p>
<p>好吧，谷歌大法出动，一番搜索下来，找到了<a href="https://github.com/iissnan/hexo-theme-next/issues/737" target="_blank" rel="external">这个帖子</a>。</p>
<p>里边说到：</p>
<blockquote>
<p>有碰到 YAMLException: bad indentation of a mapping entry 这种提示的，最好找个 YAML Lint 验证下 _config.yml 是否有问题。</p>
</blockquote>
<p>往回翻看报错信息，还真有这个报错，那有可能是配置格式出错了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">YAMLException: can <span class="keyword">not</span> read a block mapping entry; a multiline key may <span class="keyword">not</span> be an implicit key at line <span class="number">144</span>, column <span class="number">1</span>:</div><div class="line">    <span class="comment"># Table Of Contents in the Sidebar</span></div></pre></td></tr></table></figure>
<p>回到配置文件，在144行的上边，发现是少了一个空格。。</p>
<p>这个是错误的版本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">avatar:/images/avatar.png</div></pre></td></tr></table></figure>
<p>这个是正确的版本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">avatar: /images/avatar.png</div></pre></td></tr></table></figure>
<p>问题解决，PS：Next主题的效果很合胃口啊~哈哈。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;昨天晚上睡前，打算把博客的主题，替换成Next，&lt;a href=&quot;https://github.com/iissnan/hexo-theme-next&quot;&gt;Next的Github地址&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;对着Next的使用文档就开始进行配置，到了最终执行Hexo g来生成博客文章的时候，报错了！！&lt;/p&gt;
    
    </summary>
    
    
      <category term="杂" scheme="http://jianbing.github.io/tags/%E6%9D%82/"/>
    
  </entry>
  
  <entry>
    <title>ADB工具类分享</title>
    <link href="http://jianbing.github.io/2016/04/27/adb-tool/"/>
    <id>http://jianbing.github.io/2016/04/27/adb-tool/</id>
    <published>2016-04-26T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.449Z</updated>
    
    <content type="html"><![CDATA[<p>之前封装了一批基于adb命令的函数，用于辅助游戏安卓版本的测试，<a href="https://github.com/jianbing/utils/blob/master/android.py" target="_blank" rel="external">源码在此</a>。</p>
<p>虽然已经比较方便了，但是在使用过程中，还是存在一些不足。</p>
<ul>
<li>不支持同时连接多部手机</li>
<li>不支持adb通过wifi连接手机</li>
<li>部分函数的写法不太合理</li>
</ul>
<p>周末的时候，重新封装了一个ADB工具类，把之前的函数整合进去。来看看怎么使用吧~</p>
<a id="more"></a>
<h3 id="连接手机"><a href="#连接手机" class="headerlink" title="连接手机"></a>连接手机</h3><p>USB方式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb = ADB()</div></pre></td></tr></table></figure>
<p>Wifi方式，手机需要安装adbWireless，在手机端启动后，查看当前手机的IP<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb = ADB(adb_remote=<span class="string">'192.168.1.120'</span>)</div></pre></td></tr></table></figure></p>
<h3 id="常用功能"><a href="#常用功能" class="headerlink" title="常用功能"></a>常用功能</h3><p>屏幕截图，保存到指定目录，可以在截图的文件名中添加附加信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb.screenshot(<span class="string">r"E:\shot"</span>, <span class="string">"screenshot"</span>)</div></pre></td></tr></table></figure>
<p>查看当前运行的程序信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">print</span> adb.current_package_name()   </div><div class="line"><span class="keyword">print</span> adb.current_activity_name()</div></pre></td></tr></table></figure>
<p>查看程序的CPU和内存占用情况</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">print</span> adb.get_mem_using(adb.current_package_name())</div><div class="line"><span class="keyword">print</span> adb.get_cpu_using(adb.current_activity_name())</div></pre></td></tr></table></figure>
<p>备份和自动安装APK</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">adb.backup_current_apk()  <span class="comment"># 备份当前正在运行的APK</span></div><div class="line">adb.auto_install(<span class="string">r"E:\apks"</span>)  <span class="comment"># 自动安装指定目录的全部APK文件，如果已经安装，则先卸载后再进行安装</span></div></pre></td></tr></table></figure>
<p>执行adb和adb shell命令</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">print</span> adb.adb(<span class="string">'devices'</span>)</div><div class="line"><span class="keyword">print</span> adb.adb_shell(<span class="string">'dumpsys cpuinfo'</span>)</div></pre></td></tr></table></figure>
<p>打开调试模式，会打印每一次执行的adb命令，以及返回的结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb = ADB(debug=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<h3 id="更多的功能"><a href="#更多的功能" class="headerlink" title="更多的功能"></a>更多的功能</h3><p>自己去源码中发现吧，<a href="https://github.com/jianbing/utils/blob/master/tools/adb.py" target="_blank" rel="external">点击查看</a>。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前封装了一批基于adb命令的函数，用于辅助游戏安卓版本的测试，&lt;a href=&quot;https://github.com/jianbing/utils/blob/master/android.py&quot;&gt;源码在此&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;虽然已经比较方便了，但是在使用过程中，还是存在一些不足。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不支持同时连接多部手机&lt;/li&gt;
&lt;li&gt;不支持adb通过wifi连接手机&lt;/li&gt;
&lt;li&gt;部分函数的写法不太合理&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;周末的时候，重新封装了一个ADB工具类，把之前的函数整合进去。来看看怎么使用吧~&lt;/p&gt;
    
    </summary>
    
    
      <category term="游戏测试" scheme="http://jianbing.github.io/tags/%E6%B8%B8%E6%88%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="python" scheme="http://jianbing.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>安卓性能专项之CPU内存篇</title>
    <link href="http://jianbing.github.io/2016/04/23/cpu-memory/"/>
    <id>http://jianbing.github.io/2016/04/23/cpu-memory/</id>
    <published>2016-04-22T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.469Z</updated>
    
    <content type="html"><![CDATA[<p>对手游进行测试的时候，需要留意游戏在各种常见场景下CPU，内存的使用情况。</p>
<p>空闲状态的场景，比如主城界面待机，游戏Home到后台运行。</p>
<p>高负荷状态的场景，比如多人同屏，连续的战斗场景等。</p>
<p>怎么去获取当前的CPU，内存占用情况呢？有两个比较常用的方式：</p>
<a id="more"></a>
<h4 id="APP性能测试工具"><a href="#APP性能测试工具" class="headerlink" title="APP性能测试工具"></a>APP性能测试工具</h4><p>第三方的APP性能测试工具：GT，Wetest，Emmagee等。</p>
<p>使用方式：各APP的帮助文件已经详细说明了~不再重复~</p>
<h3 id="adb方式"><a href="#adb方式" class="headerlink" title="adb方式"></a>adb方式</h3><h4 id="查看CPU占用"><a href="#查看CPU占用" class="headerlink" title="查看CPU占用"></a>查看CPU占用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb  shell dumpsys cpuinfo</div></pre></td></tr></table></figure>
<p>可以看到类似的结果:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">CPU usage <span class="keyword">from</span> <span class="number">16749</span>ms to <span class="number">1803</span>ms ago:</div><div class="line">  <span class="number">24</span>% <span class="number">15167</span>/com.supercell.clashroyale.qihoo: <span class="number">23</span>% user + <span class="number">1</span>% kernel / faults: <span class="number">504</span> minor</div><div class="line">  <span class="number">7.8</span>% <span class="number">2146</span>/surfaceflinger: <span class="number">3.3</span>% user + <span class="number">4.4</span>% kernel</div><div class="line">  <span class="number">3</span>% <span class="number">16479</span>/com.qihoo.daemon: <span class="number">2.5</span>% user + <span class="number">0.5</span>% kernel / faults: <span class="number">267</span> minor</div><div class="line">  ......</div><div class="line">  <span class="number">0</span>% <span class="number">2867</span>/com.android.phone: <span class="number">0</span>% user + <span class="number">0</span>% kernel</div><div class="line">  <span class="number">0</span>% <span class="number">2937</span>/com.meizu.cloud: <span class="number">0</span>% user + <span class="number">0</span>% kernel</div><div class="line">  <span class="number">0</span>% <span class="number">3499</span>/sogou.mobile.explorer.hotwords: <span class="number">0</span>% user + <span class="number">0</span>% kernel</div><div class="line">  <span class="number">0</span>% <span class="number">3641</span>/com.android.settings: <span class="number">0</span>% user + <span class="number">0</span>% kernel</div><div class="line">  <span class="number">0</span>% <span class="number">14666</span>/com.github.uiautomator: <span class="number">0</span>% user + <span class="number">0</span>% kernel</div><div class="line">  <span class="number">0</span>% <span class="number">15156</span>/ksoftirqd/<span class="number">1</span>: <span class="number">0</span>% user + <span class="number">0</span>% kernel</div><div class="line">  <span class="number">0</span>% <span class="number">15218</span>/com.jedigames.qh360:QRemote: <span class="number">0</span>% user + <span class="number">0</span>% kernel / faults: <span class="number">2</span> minor</div><div class="line">  <span class="number">0</span>% <span class="number">31582</span>/wpa_supplicant: <span class="number">0</span>% user + <span class="number">0</span>% kernel</div><div class="line"><span class="number">9.4</span>% TOTAL: <span class="number">7.3</span>% user + <span class="number">2</span>% kernel + <span class="number">0</span>% iowait + <span class="number">0</span>% softirq</div></pre></td></tr></table></figure>
<p>可以通过指定游戏包名来减少显示的结果，以最近在玩的皇室战争为例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb  shell dumpsys cpuinfo |findstr <span class="string">"com.supercell.clashroyale.qihoo TOTAL"</span>   <span class="comment"># 查找包含com.supercell.clashroyale.qihoo或者TOTAL的行</span></div></pre></td></tr></table></figure>
<p>显示的结果减少为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">  <span class="number">33</span>% <span class="number">15167</span>/com.supercell.clashroyale.qihoo: <span class="number">28</span>% user + <span class="number">4.8</span>% kernel / faults: <span class="number">28531</span> minor <span class="number">20</span> major</div><div class="line"><span class="number">12</span>% TOTAL: <span class="number">7.8</span>% user + <span class="number">3.3</span>% kernel + <span class="number">0.7</span>% iowait + <span class="number">0.1</span>% softirq</div></pre></td></tr></table></figure>
<p>这里表示：当前CPU总占用为12%，com.supercell.clashroyale.qihoo（皇室战争）的CPU占用为12%*33%=3.96%</p>
<h3 id="查看内存占用"><a href="#查看内存占用" class="headerlink" title="查看内存占用"></a>查看内存占用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell dumpsys meminfo com.supercell.clashroyale.qihoo</div></pre></td></tr></table></figure>
<p>得到以下信息：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">Applications Memory Usage (kB):</div><div class="line">Uptime: <span class="number">79407732</span> Realtime: <span class="number">700252674</span></div><div class="line"></div><div class="line">** MEMINFO <span class="keyword">in</span> pid <span class="number">18040</span> [com.supercell.clashroyale.qihoo] **</div><div class="line">                   Pss  Private  Private  Swapped     Heap     Heap     Heap</div><div class="line">                 Total    Dirty    Clean    Dirty     Size    Alloc     Free</div><div class="line">                ------   ------   ------   ------   ------   ------   ------</div><div class="line">  Native Heap        <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span>   <span class="number">106160</span>    <span class="number">52209</span>      <span class="number">262</span></div><div class="line">  Dalvik Heap    <span class="number">13819</span>    <span class="number">13380</span>        <span class="number">0</span>        <span class="number">0</span>    <span class="number">67460</span>    <span class="number">29143</span>    <span class="number">38317</span></div><div class="line"> Dalvik Other     <span class="number">4046</span>     <span class="number">3976</span>        <span class="number">0</span>        <span class="number">0</span></div><div class="line">        Stack      <span class="number">344</span>      <span class="number">344</span>        <span class="number">0</span>        <span class="number">0</span></div><div class="line">       Ashmem      <span class="number">138</span>      <span class="number">128</span>        <span class="number">0</span>        <span class="number">0</span></div><div class="line">    Other dev    <span class="number">85959</span>     <span class="number">3032</span>    <span class="number">82852</span>        <span class="number">0</span></div><div class="line">     .so mmap     <span class="number">5421</span>     <span class="number">1016</span>     <span class="number">2200</span>        <span class="number">0</span></div><div class="line">    .jar mmap        <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span></div><div class="line">    .apk mmap     <span class="number">1414</span>        <span class="number">0</span>     <span class="number">1232</span>        <span class="number">0</span></div><div class="line">    .ttf mmap      <span class="number">655</span>        <span class="number">0</span>      <span class="number">428</span>        <span class="number">0</span></div><div class="line">    .dex mmap     <span class="number">4206</span>       <span class="number">44</span>     <span class="number">2632</span>        <span class="number">0</span></div><div class="line">   Other mmap       <span class="number">65</span>       <span class="number">12</span>       <span class="number">12</span>        <span class="number">0</span></div><div class="line">      Unknown    <span class="number">42884</span>    <span class="number">42876</span>        <span class="number">0</span>        <span class="number">0</span></div><div class="line">        TOTAL   <span class="number">158951</span>    <span class="number">64808</span>    <span class="number">89356</span>        <span class="number">0</span>   <span class="number">173620</span>    <span class="number">81352</span>    <span class="number">38579</span></div><div class="line"></div><div class="line"> Objects</div><div class="line">               Views:      <span class="number">137</span>         ViewRootImpl:        <span class="number">5</span></div><div class="line">         AppContexts:        <span class="number">4</span>           Activities:        <span class="number">2</span></div><div class="line">              Assets:        <span class="number">5</span>        AssetManagers:        <span class="number">5</span></div><div class="line">       Local Binders:       <span class="number">23</span>        Proxy Binders:       <span class="number">44</span></div><div class="line">    Death Recipients:       <span class="number">13</span></div><div class="line">     OpenSSL Sockets:        <span class="number">9</span></div><div class="line"></div><div class="line"> SQL</div><div class="line">         MEMORY_USED:        <span class="number">0</span></div><div class="line">  PAGECACHE_OVERFLOW:        <span class="number">0</span>          MALLOC_SIZE:       <span class="number">62</span></div></pre></td></tr></table></figure>
<p>这里表示：当前的应用，内存总占用是158951KB</p>
<p>PS：几个内存相关的术语，一般关注PSS。</p>
<blockquote>
<p>VSS - Virtual Set Size 虚拟耗用内存（包含共享库占用的内存）<br>RSS - Resident Set Size 实际使用物理内存（包含共享库占用的内存）<br>PSS - Proportional Set Size 实际使用的物理内存（比例分配共享库占用的内存）<br>USS - Unique Set Size 进程独自占用的物理内存（不包含共享库占用的内存）</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;对手游进行测试的时候，需要留意游戏在各种常见场景下CPU，内存的使用情况。&lt;/p&gt;
&lt;p&gt;空闲状态的场景，比如主城界面待机，游戏Home到后台运行。&lt;/p&gt;
&lt;p&gt;高负荷状态的场景，比如多人同屏，连续的战斗场景等。&lt;/p&gt;
&lt;p&gt;怎么去获取当前的CPU，内存占用情况呢？有两个比较常用的方式：&lt;/p&gt;
    
    </summary>
    
    
      <category term="游戏测试" scheme="http://jianbing.github.io/tags/%E6%B8%B8%E6%88%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>一键关闭迅雷后台程序</title>
    <link href="http://jianbing.github.io/2016/04/21/kill_thunderPlatform/"/>
    <id>http://jianbing.github.io/2016/04/21/kill_thunderPlatform/</id>
    <published>2016-04-20T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.489Z</updated>
    
    <content type="html"><![CDATA[<p>退出了迅雷后，有时候会发现它还是在悄悄地上传，占用着带宽，在任务管理器里边查看，是一个叫ThunderPlatform.exe的程序。</p>
<p>百度了下，很多解决方案都是禁用XLServicePlatform服务。</p>
<p>这里分享一个用Python来自动关闭ThunderPlatform.exe的方式，需要用到一个库，叫psutil。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install psutil 安装即可</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>代码如下：</p>
<blockquote>
<p>开发环境：Python2.7+Win10+Pycharm</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</div><div class="line"><span class="keyword">import</span> psutil</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line">num = <span class="number">1</span></div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    <span class="keyword">print</span> <span class="string">"checking,times:&#123;&#125;"</span>.format(num)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> psutil.process_iter():</div><div class="line">        <span class="keyword">if</span> i.name() == <span class="string">"ThunderPlatform.exe"</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">"find ThunderPlatform.exe,start to kill"</span></div><div class="line">            i.kill()</div><div class="line">            <span class="keyword">print</span> <span class="string">"finish kill"</span></div><div class="line">            <span class="keyword">break</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"not found,sleep 60s"</span></div><div class="line"></div><div class="line">    time.sleep(<span class="number">60</span>)</div><div class="line">    num += <span class="number">1</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;退出了迅雷后，有时候会发现它还是在悄悄地上传，占用着带宽，在任务管理器里边查看，是一个叫ThunderPlatform.exe的程序。&lt;/p&gt;
&lt;p&gt;百度了下，很多解决方案都是禁用XLServicePlatform服务。&lt;/p&gt;
&lt;p&gt;这里分享一个用Python来自动关闭ThunderPlatform.exe的方式，需要用到一个库，叫psutil。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;pip install psutil 安装即可&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://jianbing.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>检查端口占用情况</title>
    <link href="http://jianbing.github.io/2016/04/20/kill_5037/"/>
    <id>http://jianbing.github.io/2016/04/20/kill_5037/</id>
    <published>2016-04-19T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.485Z</updated>
    
    <content type="html"><![CDATA[<p>使用adb的时候，有时候会发现5037端口被其他程序占用了。于是有了以下这个脚本，检查端口被占用的情况，并结束该进程。</p>
<a id="more"></a>
<blockquote>
<p>开发环境：Python2.7+Win10+Pycharm</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_port_used</span><span class="params">(port=<span class="number">5037</span>, kill=False)</span>:</span></div><div class="line">    cmd = <span class="string">'netstat -ano | findstr &#123;&#125; | findstr  LISTENING'</span>.format(port)</div><div class="line">    <span class="keyword">print</span> cmd</div><div class="line">    result = os.popen(cmd).read()</div><div class="line">    <span class="keyword">print</span> result</div><div class="line"></div><div class="line">    <span class="keyword">if</span> result != <span class="string">''</span>:</div><div class="line">        pid = result.split()[<span class="number">-1</span>]</div><div class="line"></div><div class="line">        result = os.popen(<span class="string">'tasklist /FI "PID eq &#123;0&#125;'</span>.format(pid)).read()</div><div class="line">        <span class="keyword">print</span> result</div><div class="line"></div><div class="line">        position = result.rfind(<span class="string">'====='</span>.encode())</div><div class="line">        program_name = result[position+<span class="number">5</span>:].split()[<span class="number">0</span>]</div><div class="line">        <span class="keyword">print</span> <span class="string">"占用的程序是&#123;&#125;"</span>.format(program_name)</div><div class="line"></div><div class="line">        result = os.popen(<span class="string">'wmic process where name="&#123;0&#125;" get executablepath'</span>.format(program_name)).read()</div><div class="line"></div><div class="line">        result = result.split()</div><div class="line">        <span class="keyword">print</span> <span class="string">"占用的程序所在位置：&#123;&#125;"</span>.format(result[<span class="number">1</span>])</div><div class="line"></div><div class="line">        cmd = <span class="string">"explorer &#123;0&#125;"</span>.format(os.path.dirname(result[<span class="number">1</span>]))</div><div class="line">        os.popen(cmd)  <span class="comment"># 打开所在文件夹</span></div><div class="line">        <span class="keyword">if</span> kill:</div><div class="line">            os.popen(<span class="string">"taskkill /F /PID &#123;0&#125;"</span>.format(pid))   <span class="comment"># 结束进程</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'&#123;&#125;端口没有被占用'</span>.format(port)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    is_port_used()</div><div class="line">    input()</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">netstat -ano | findstr <span class="number">5037</span> | findstr  LISTENING</div><div class="line">  TCP    <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5037</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">0</span>              LISTENING       <span class="number">16600</span></div><div class="line"></div><div class="line"></div><div class="line">映像名称                       PID 会话名              会话<span class="comment">#       内存使用</span></div><div class="line">========================= ======== ================ =========== ============</div><div class="line">adb.exe                      <span class="number">16600</span> Console                    <span class="number">1</span>      <span class="number">3</span>,<span class="number">868</span> K</div><div class="line"></div><div class="line">占用的程序是adb.exe</div><div class="line">占用的程序所在位置：C:\Android\sdk\platform-tools\adb.exe</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用adb的时候，有时候会发现5037端口被其他程序占用了。于是有了以下这个脚本，检查端口被占用的情况，并结束该进程。&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://jianbing.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>计算Python函数的运行时间</title>
    <link href="http://jianbing.github.io/2016/04/15/count-pyfunc-running-time/"/>
    <id>http://jianbing.github.io/2016/04/15/count-pyfunc-running-time/</id>
    <published>2016-04-14T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.465Z</updated>
    
    <content type="html"><![CDATA[<p>有时候需要计算一下函数的时间，可以有以下的几种方式：</p>
<h3 id="简单粗暴式"><a href="#简单粗暴式" class="headerlink" title="简单粗暴式"></a>简单粗暴式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:  </div><div class="line">    start = time.time()</div><div class="line">    func()</div><div class="line">    <span class="keyword">print</span> time.time() - start</div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="简单粗暴式的升级版"><a href="#简单粗暴式的升级版" class="headerlink" title="简单粗暴式的升级版"></a>简单粗暴式的升级版</h3><p>使用装饰器<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_running_time</span><span class="params">(func)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_count_running_time</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">        start = time.time()</div><div class="line">        res = func(*args, **kwargs)</div><div class="line">        print(<span class="string">'cost time :&#123;0&#125;'</span>.format(time.time() - start))</div><div class="line">        <span class="keyword">return</span> res</div><div class="line">    <span class="keyword">return</span> _count_running_time</div><div class="line"></div><div class="line"><span class="meta">@count_running_time</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    func()</div></pre></td></tr></table></figure></p>
<blockquote>
<p>以上两种方式，只能简单统计函数的总运行时间，如果函数复杂，需要分析里边调用的次数和耗时，则满足不了我们的需求。</p>
</blockquote>
<h3 id="优雅的统计方式"><a href="#优雅的统计方式" class="headerlink" title="优雅的统计方式"></a>优雅的统计方式</h3><p>使用cProfile来进行统计，使用pstats来分析结果，直接看代码吧~</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">profile_func</span><span class="params">(func)</span>:</span></div><div class="line">    <span class="keyword">import</span> cProfile</div><div class="line">    cProfile.run(<span class="string">"&#123;&#125;()"</span>.format(func.func_name),<span class="string">"prof.txt"</span>)</div><div class="line">    <span class="keyword">import</span> pstats</div><div class="line">    p = pstats.Stats(<span class="string">"prof.txt"</span>)</div><div class="line">    p.sort_stats(<span class="string">"time"</span>).print_stats()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'hello world'</span></div><div class="line">    <span class="keyword">import</span> time</div><div class="line">    time.sleep(<span class="number">3</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    profile_func(func)</div></pre></td></tr></table></figure>
<p>打印如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">hello world</div><div class="line">Sat Apr <span class="number">16</span> <span class="number">17</span>:<span class="number">19</span>:<span class="number">10</span> <span class="number">2016</span>    prof.txt</div><div class="line"></div><div class="line">         <span class="number">4</span> function calls <span class="keyword">in</span> <span class="number">3.000</span> seconds</div><div class="line"></div><div class="line">   Ordered by: internal time</div><div class="line"></div><div class="line">   ncalls  tottime  percall  cumtime  percall filename:lineno(function)</div><div class="line">        <span class="number">1</span>    <span class="number">3.000</span>    <span class="number">3.000</span>    <span class="number">3.000</span>    <span class="number">3.000</span> &#123;time.sleep&#125;</div><div class="line">        <span class="number">1</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">3.000</span>    <span class="number">3.000</span> C:/Py27Project/testtools/local_test/__init__.py:<span class="number">12</span>(func)</div><div class="line">        <span class="number">1</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">3.000</span>    <span class="number">3.000</span> &lt;string&gt;:<span class="number">1</span>(&lt;module&gt;)</div><div class="line">        <span class="number">1</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span>    <span class="number">0.000</span> &#123;method <span class="string">'disable'</span> of <span class="string">'_lsprof.Profiler'</span> objects&#125;</div></pre></td></tr></table></figure>
<p>函数调用的次数和耗时一目了然~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;有时候需要计算一下函数的时间，可以有以下的几种方式：&lt;/p&gt;
&lt;h3 id=&quot;简单粗暴式&quot;&gt;&lt;a href=&quot;#简单粗暴式&quot; class=&quot;headerlink&quot; title=&quot;简单粗暴式&quot;&gt;&lt;/a&gt;简单粗暴式&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; time&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;pass&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;string&quot;&gt;&#39;__main__&#39;&lt;/span&gt;:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    start = time.time()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    func()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; time.time() - start&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://jianbing.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>安卓性能专项之FPS测试篇</title>
    <link href="http://jianbing.github.io/2016/04/13/unity-fps-tool/"/>
    <id>http://jianbing.github.io/2016/04/13/unity-fps-tool/</id>
    <published>2016-04-12T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.531Z</updated>
    
    <content type="html"><![CDATA[<h3 id="FPS测试"><a href="#FPS测试" class="headerlink" title="FPS测试"></a>FPS测试</h3><p>FPS是每秒传输帧数(Frames Per Second)，每秒钟帧数越多，则画面看起来越流畅，FPS测试也是手机游戏性能测试的一个重点专项。</p>
<h3 id="测试工具"><a href="#测试工具" class="headerlink" title="测试工具"></a>测试工具</h3><h4 id="APP性能测试工具"><a href="#APP性能测试工具" class="headerlink" title="APP性能测试工具"></a>APP性能测试工具</h4><p>第三方的APP性能测试工具，主流代表，GT，Wetest，Emmagee等。</p>
<p>使用方式：各APP的帮助文件已经详细说明了~不再重复~</p>
<a id="more"></a>
<h3 id="adb方式"><a href="#adb方式" class="headerlink" title="adb方式"></a>adb方式</h3><p>开发者选项–&gt;GPU呈现模式分析–&gt;使用adb shell dumpsys gfxinfo</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell dumpsys gfxinfo <span class="string">"your app package name"</span> &gt;fps.txt</div></pre></td></tr></table></figure>
<p>查看fps.txt，在Profile data in ms下方，查看刷新时间。</p>
<blockquote>
<p>Unity手游并不适用这个方式</p>
</blockquote>
<h3 id="使用WeTest查看FPS"><a href="#使用WeTest查看FPS" class="headerlink" title="使用WeTest查看FPS"></a>使用WeTest查看FPS</h3><p>鹅厂出品WeTest性能测试工具，可以实时计算出手游FPS，实测挺准的。推荐使用。</p>
<h3 id="Unity自制FPS显示工具"><a href="#Unity自制FPS显示工具" class="headerlink" title="Unity自制FPS显示工具"></a>Unity自制FPS显示工具</h3><p>我们也可以制作一个Unity专用的FPS显示工具，与Wetest相比，我们可以有更多的定制内容，比如加入帧数低于指定数字时，显示数字变成红色。</p>
<p>工具原理：</p>
<p>OnGUI方法是每帧调用的，使用一个变量，在每帧调用的时候自增，每隔一定时间统计帧数总量，总量除以累计的时间，就为每秒传输帧数FPS了，在Unity官网就有实例代码。</p>
<p>使用方式：保存为ShowFPS.cs，直接挂在主场景的Main Camera即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">using UnityEngine;</div><div class="line">using System.Collections;</div><div class="line"></div><div class="line">public class ShowFPS : MonoBehaviour &#123;</div><div class="line"></div><div class="line">    public GUIStyle FPSStyle;</div><div class="line"></div><div class="line">    public float updateInterval = 0.5F;  //统计间隔</div><div class="line"></div><div class="line">    private float lastInterval;</div><div class="line"></div><div class="line">    private int frames = 0;</div><div class="line"></div><div class="line">    private float fps;</div><div class="line"></div><div class="line">    private int warnFPS = 40;   //FPS警告临界值</div><div class="line"></div><div class="line">    void Start() &#123;</div><div class="line"></div><div class="line">        lastInterval = Time.realtimeSinceStartup;</div><div class="line"></div><div class="line">        frames = 0;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    void OnGUI() &#123;</div><div class="line"></div><div class="line">        if (fps &lt; warnFPS) &#123;</div><div class="line">            FPSStyle.normal.textColor = Color.red;</div><div class="line">        &#125; else &#123;</div><div class="line">            FPSStyle.normal.textColor = Color.white;               </div><div class="line">        &#125;</div><div class="line"></div><div class="line">        GUI.Label(new Rect(5, 200, 80, 30), &quot;FPS:&quot; + fps.ToString(&quot;f2&quot;), FPSStyle);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    void Update() &#123;</div><div class="line"></div><div class="line">        ++frames;</div><div class="line"></div><div class="line">        if (Time.realtimeSinceStartup &gt; lastInterval + updateInterval) &#123;</div><div class="line">            fps = frames / (Time.realtimeSinceStartup - lastInterval);</div><div class="line">            frames = 0;</div><div class="line">            lastInterval = Time.realtimeSinceStartup;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;FPS测试&quot;&gt;&lt;a href=&quot;#FPS测试&quot; class=&quot;headerlink&quot; title=&quot;FPS测试&quot;&gt;&lt;/a&gt;FPS测试&lt;/h3&gt;&lt;p&gt;FPS是每秒传输帧数(Frames Per Second)，每秒钟帧数越多，则画面看起来越流畅，FPS测试也是手机游戏性能测试的一个重点专项。&lt;/p&gt;
&lt;h3 id=&quot;测试工具&quot;&gt;&lt;a href=&quot;#测试工具&quot; class=&quot;headerlink&quot; title=&quot;测试工具&quot;&gt;&lt;/a&gt;测试工具&lt;/h3&gt;&lt;h4 id=&quot;APP性能测试工具&quot;&gt;&lt;a href=&quot;#APP性能测试工具&quot; class=&quot;headerlink&quot; title=&quot;APP性能测试工具&quot;&gt;&lt;/a&gt;APP性能测试工具&lt;/h4&gt;&lt;p&gt;第三方的APP性能测试工具，主流代表，GT，Wetest，Emmagee等。&lt;/p&gt;
&lt;p&gt;使用方式：各APP的帮助文件已经详细说明了~不再重复~&lt;/p&gt;
    
    </summary>
    
    
      <category term="游戏测试" scheme="http://jianbing.github.io/tags/%E6%B8%B8%E6%88%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>安卓性能专项之流量测试篇</title>
    <link href="http://jianbing.github.io/2016/04/10/network-traffic-test/"/>
    <id>http://jianbing.github.io/2016/04/10/network-traffic-test/</id>
    <published>2016-04-09T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.497Z</updated>
    
    <content type="html"><![CDATA[<h3 id="从一个Bug说起"><a href="#从一个Bug说起" class="headerlink" title="从一个Bug说起"></a>从一个Bug说起</h3><p>之前的项目曾经遇到这样一个问题：</p>
<p>在弱网环境下，几乎每次打开排行榜，都会出现小菊花（加载中），但是在wifi环境下则不会，初步猜测是数据包太大，导致加载速度慢。</p>
<p>使用工具一查，进入排行榜，服务端返回的数据包居然达到了20KB，而我们的竞品，只有2.36KB。</p>
<h3 id="流量测试是什么"><a href="#流量测试是什么" class="headerlink" title="流量测试是什么"></a>流量测试是什么</h3><p>流量测试是安卓APP性能测试的其中一个专项，测试APP在联网环境下，网络流量的消耗情况。</p>
<a id="more"></a>
<h3 id="流量测试怎么做"><a href="#流量测试怎么做" class="headerlink" title="流量测试怎么做"></a>流量测试怎么做</h3><p>使用过以下几种方式：</p>
<ul>
<li><p>通过Adb获取流量数据，TesterHome上的一篇文章有详细的讲述，就不再重复了，<a href="https://testerhome.com/topics/2643" target="_blank" rel="external">点击访问</a>。</p>
</li>
<li><p>使用tcpdump抓包，使用wireshark分析。</p>
</li>
<li><p>使用性能测试工具GT，Wetest，Emmagee，记录流量数据后，导出查看。</p>
</li>
<li><p>在游戏代码中打印，汇总流量数据。</p>
</li>
</ul>
<h3 id="最简单有效的方式"><a href="#最简单有效的方式" class="headerlink" title="最简单有效的方式"></a>最简单有效的方式</h3><p>使用GT这类成熟的性能测试工具，可以直接生成csv文件导出，或者在云端通过图表形式展示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">		transmitted	received</div><div class="line">min		<span class="number">19</span>		<span class="number">108</span></div><div class="line">max		<span class="number">22</span>		<span class="number">137</span></div><div class="line">avg		<span class="number">21</span>		<span class="number">132</span></div><div class="line">		</div><div class="line"><span class="number">11</span>:<span class="number">41</span>:<span class="number">15.2</span>	<span class="number">19</span>		<span class="number">108</span></div><div class="line"><span class="number">11</span>:<span class="number">41</span>:<span class="number">16.4</span>	<span class="number">20</span>		<span class="number">111</span></div><div class="line"><span class="number">11</span>:<span class="number">41</span>:<span class="number">17.5</span>	<span class="number">21</span>		<span class="number">136</span></div><div class="line"><span class="number">11</span>:<span class="number">41</span>:<span class="number">18.7</span>	<span class="number">22</span>		<span class="number">136</span></div><div class="line"><span class="number">11</span>:<span class="number">41</span>:<span class="number">19.8</span>	<span class="number">22</span>		<span class="number">137</span></div><div class="line"><span class="number">11</span>:<span class="number">41</span>:<span class="number">21.0</span>	<span class="number">22</span>		<span class="number">137</span></div></pre></td></tr></table></figure>
<p>不足之处，只是单纯记录每一秒的流量消耗，无法记录是什么操作产生的流量消耗。另外，如果同一秒中产生了多个请求，消耗的记录会积累到一起。</p>
<p>tcpdump+wireshark可以精确到每一个请求产生的流量消耗，同样也无法直观知道具体是哪个操作。</p>
<h3 id="最精确直观的方式"><a href="#最精确直观的方式" class="headerlink" title="最精确直观的方式"></a>最精确直观的方式</h3><p>怎么样才能直观地查看每一个请求所属的操作呢？答案是自制一个流量统计工具。</p>
<p>工具原理：</p>
<p>在客户端代码内，每次请求发送与接收的时候，嵌入统计流量的代码，并汇总到一起，完成测试后，输出到文本上。</p>
<p>保存流量数据的工具类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class TrafficCount &#123;</div><div class="line">    private static Queue&lt;string&gt; trafficInfo = new Queue&lt;string&gt;();</div><div class="line"></div><div class="line">    public static void Add(string s) &#123;</div><div class="line">        trafficInfo.Enqueue(s);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static void WriteToFile(string filePath) &#123;</div><div class="line"></div><div class="line">        StreamWriter sw = new StreamWriter(filePath);</div><div class="line">        foreach(var i in trafficInfo) &#123;</div><div class="line">            sw.WriteLine(i);</div><div class="line">        &#125;</div><div class="line">        sw.Close();</div><div class="line"></div><div class="line">        Debug.LogWarning(&quot;成功保存&quot;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>在客户端发送请求和接收响应的地方加入流量统计(已发送请求为例，截取了部分代码，这里采用了硬编码的方式，其实不太合理)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">SocketError error;</div><div class="line">var sended = mSocket.Send(output, SocketFlags.None, out error);</div><div class="line">if (error == SocketError.Success) &#123;</div><div class="line">    obj.OK();</div><div class="line">    //统计代码</div><div class="line">    this.Debug(&quot;成功发送 &#123;0&#125; 字节数据&quot;, sended);</div><div class="line">    TrafficCount.Add(&quot;成功发送&quot;+ sended + &quot;字节数据&quot;);</div><div class="line">    //统计代码</div><div class="line">&#125; else &#123;</div><div class="line">    obj.Error();</div><div class="line">    this.Error(&quot;发送数据失败: &#123;0&#125;&quot;, error.ToString());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在主场景上，挂一个MonoBehaviour脚本，来调用开始统计和保存文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">void OnGUI() &#123;</div><div class="line">    if (GUI.Button(new Rect(0, (Screen.height/2), 50, 30), &quot;流量测试&quot;)) &#123;</div><div class="line">	//监听发送请求和接收返回，获取操作的协议号</div><div class="line">        EventHelper.Ins.Get&lt;SystemEventGroup&gt;().onRequest.AddHandler((ss, req) =&gt; &#123;</div><div class="line">            Debug.Log(req.Protocol);</div><div class="line">            TrafficCount.Add(req.Protocol.ToString());</div><div class="line">        &#125;);</div><div class="line">        EventHelper.Ins.Get&lt;SystemEventGroup&gt;().onResponse.AddHandler((ss, req) =&gt; &#123;</div><div class="line">            Debug.Log(req.Protocol+&quot;成功返回&quot;);</div><div class="line">            TrafficCount.Add(req.Protocol + &quot;成功返回&quot;);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (GUI.Button(new Rect(0, (Screen.height/2)+50, 50, 30), &quot;保存&quot;)) &#123;</div><div class="line"></div><div class="line">        TrafficCount.WriteToFile(@&quot;C:\VSTest\result.txt&quot;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最终输出的文本是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="number">110101</span></div><div class="line">成功发送<span class="number">77</span>字节数据</div><div class="line">接收到了<span class="number">55</span>字节数据</div><div class="line"><span class="number">110101</span>成功返回</div><div class="line"><span class="number">107501</span></div><div class="line">成功发送<span class="number">84</span>字节数据</div><div class="line">接收到了<span class="number">28</span>字节数据</div><div class="line"><span class="number">107501</span>成功返回</div></pre></td></tr></table></figure>
<h3 id="怎么优化"><a href="#怎么优化" class="headerlink" title="怎么优化"></a>怎么优化</h3><ul>
<li>去除响应包的冗余内容，如排行榜只需要名称，所在工会，等级等数据，并不需要玩家阵型数据。</li>
<li>有些系统，无需每次点击都请求最新数据，如排行榜，进入后第一次点击里边的各个榜单会请求数据，在退出排行榜之前，再次切换榜单，会读取旧数据，不再发送新请求。</li>
</ul>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>时间段内流量的总消耗测试，建议使用GT类的工具。</p>
<p>具体协议的流量消耗测试，使用自制工具分析。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;从一个Bug说起&quot;&gt;&lt;a href=&quot;#从一个Bug说起&quot; class=&quot;headerlink&quot; title=&quot;从一个Bug说起&quot;&gt;&lt;/a&gt;从一个Bug说起&lt;/h3&gt;&lt;p&gt;之前的项目曾经遇到这样一个问题：&lt;/p&gt;
&lt;p&gt;在弱网环境下，几乎每次打开排行榜，都会出现小菊花（加载中），但是在wifi环境下则不会，初步猜测是数据包太大，导致加载速度慢。&lt;/p&gt;
&lt;p&gt;使用工具一查，进入排行榜，服务端返回的数据包居然达到了20KB，而我们的竞品，只有2.36KB。&lt;/p&gt;
&lt;h3 id=&quot;流量测试是什么&quot;&gt;&lt;a href=&quot;#流量测试是什么&quot; class=&quot;headerlink&quot; title=&quot;流量测试是什么&quot;&gt;&lt;/a&gt;流量测试是什么&lt;/h3&gt;&lt;p&gt;流量测试是安卓APP性能测试的其中一个专项，测试APP在联网环境下，网络流量的消耗情况。&lt;/p&gt;
    
    </summary>
    
    
      <category term="游戏测试" scheme="http://jianbing.github.io/tags/%E6%B8%B8%E6%88%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>关于这个博客</title>
    <link href="http://jianbing.github.io/2016/04/07/about-blog/"/>
    <id>http://jianbing.github.io/2016/04/07/about-blog/</id>
    <published>2016-04-06T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.446Z</updated>
    
    <content type="html"><![CDATA[<p>时间还真是快，从上个月3号搭建好了这个博客，到今天，已经过了一个月了。</p>
<p>来点闲聊吧~</p>
<h3 id="写博客的初衷"><a href="#写博客的初衷" class="headerlink" title="写博客的初衷"></a>写博客的初衷</h3><p>作为一枚游戏测试，有一个很明显的感受是，相对于软件测试，游戏测试圈子，学习资料稀缺许多，这几年自己也逐渐有了一些积累，在这里分享自己的一些学习经验，虽然路过的人应该会比较少，有缘就看看呗。</p>
<p>之前的笔记都是记录在有道云笔记里边，只有自己看的缘故，所以比较懒，笔记往往写得比较片段化，不够系统和完整，在重新码字的过程中，会有新的思考和沉淀，也是对自己的一种提升。</p>
<a id="more"></a>
<h3 id="分享什么"><a href="#分享什么" class="headerlink" title="分享什么"></a>分享什么</h3><p>首先，手把手，一步一图的教程贴应该不多，这几年深有体会的一点是，最好的教程贴，往往都是官方的文档。</p>
<p>在这里主要分享的是各种测试类型的个人心得和经验吧，哼哼，谁说游戏测试就是点点点，除了功能测试，我们还可以关注游戏的性能情况，接口测试，数据安全，游戏兼容性，测试环境配置，工具开发等等领域。</p>
<p>还可以分享工作中对遇到的一些问题的解决思路，以及其中的重点步骤和踩过的坑。</p>
<p>还有就是折腾一些测试工具和脚本的心得体会吧，以及学习一些开源库的流水账记录，最近已经成为Star狂魔了~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;时间还真是快，从上个月3号搭建好了这个博客，到今天，已经过了一个月了。&lt;/p&gt;
&lt;p&gt;来点闲聊吧~&lt;/p&gt;
&lt;h3 id=&quot;写博客的初衷&quot;&gt;&lt;a href=&quot;#写博客的初衷&quot; class=&quot;headerlink&quot; title=&quot;写博客的初衷&quot;&gt;&lt;/a&gt;写博客的初衷&lt;/h3&gt;&lt;p&gt;作为一枚游戏测试，有一个很明显的感受是，相对于软件测试，游戏测试圈子，学习资料稀缺许多，这几年自己也逐渐有了一些积累，在这里分享自己的一些学习经验，虽然路过的人应该会比较少，有缘就看看呗。&lt;/p&gt;
&lt;p&gt;之前的笔记都是记录在有道云笔记里边，只有自己看的缘故，所以比较懒，笔记往往写得比较片段化，不够系统和完整，在重新码字的过程中，会有新的思考和沉淀，也是对自己的一种提升。&lt;/p&gt;
    
    </summary>
    
    
      <category term="杂" scheme="http://jianbing.github.io/tags/%E6%9D%82/"/>
    
  </entry>
  
  <entry>
    <title>安卓上使用tcpdump抓包的几种方式</title>
    <link href="http://jianbing.github.io/2016/04/05/android-tcpdump/"/>
    <id>http://jianbing.github.io/2016/04/05/android-tcpdump/</id>
    <published>2016-04-04T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.453Z</updated>
    
    <content type="html"><![CDATA[<p>tcpdump是Linux上强大的网络数据采集工具，可以将网络中传送的数据包完全截获下来，在安卓手机上，也可以使用它来进行抓包，后续可以用Wireshark来进行数据包的分析。</p>
<p>分享一下在安卓使用tcpdump抓包的几种方式</p>
<h3 id="1-通过GT的tcpdump插件"><a href="#1-通过GT的tcpdump插件" class="headerlink" title="1.通过GT的tcpdump插件"></a>1.通过GT的tcpdump插件</h3><p>这个是最简单粗暴的好方法~</p>
<p>GT是腾讯出品的APP性能测试工具，已经在<a href="https://github.com/TencentOpen/GT" target="_blank" rel="external">Github</a>开源。</p>
<ul>
<li>进入GT的插件页面，点击抓包，调整tcpdump参数（一般默认即可），点击开始</li>
<li>切换到要抓包的应用，操作完成后，切换回GT，停止抓包即可。</li>
<li>抓包后生成pcap文件，用adb pull导出。</li>
</ul>
<a id="more"></a>
<h3 id="2-adb调用tcpdump"><a href="#2-adb调用tcpdump" class="headerlink" title="2.adb调用tcpdump"></a>2.adb调用tcpdump</h3><ul>
<li>在tcpdump官网下载最新版本，<a href="http://www.androidtcpdump.com/android-tcpdump/downloads" target="_blank" rel="external">点击进入</a></li>
<li>手机需要提前root</li>
<li>在cmd命令行下，依次执行</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">adb shell</div><div class="line">su </div><div class="line">chmod <span class="number">777</span> /data/local</div></pre></td></tr></table></figure>
<ul>
<li>退出shell模式，把下载的tcpdump文件push到手机</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb push E:/tcpdump /data/local</div></pre></td></tr></table></figure>
<ul>
<li>在cmd下，依次执行</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">adb shell</div><div class="line">su</div><div class="line">chmod <span class="number">6755</span> /data/local/tcpdump</div><div class="line">/data/local/tcpdump -p -s <span class="number">0</span> -w /sdcard/<span class="number">001.</span>pcap     开始抓包</div><div class="line"></div><div class="line">参数含义：</div><div class="line">-p 表示不使用混杂模式</div><div class="line">-s 参数用以指定数据包捕获长度，此处指定为<span class="number">0</span>，指抓取完整的数据包</div><div class="line">-w 将结果写入一个pcap文件</div></pre></td></tr></table></figure>
<ul>
<li>按Ctrl+C停止抓包，把pcap文件pull回本地<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb pull /sdcard/<span class="number">001.</span>pcap E:/</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-手机上使用终端模拟器"><a href="#3-手机上使用终端模拟器" class="headerlink" title="3.手机上使用终端模拟器"></a>3.手机上使用终端模拟器</h3><ul>
<li>下载tcpdump，push到手机，这个和上边是一样的</li>
<li>手机上安装终端模拟器</li>
<li>运行终端模拟器，输入抓包命令</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/data/local/tcpdump -p -s <span class="number">0</span> -w /sdcard/<span class="number">001.</span>pcap</div></pre></td></tr></table></figure>
<ul>
<li>直接退出终端模拟器可以停止抓包，然后用adb pull导出</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;tcpdump是Linux上强大的网络数据采集工具，可以将网络中传送的数据包完全截获下来，在安卓手机上，也可以使用它来进行抓包，后续可以用Wireshark来进行数据包的分析。&lt;/p&gt;
&lt;p&gt;分享一下在安卓使用tcpdump抓包的几种方式&lt;/p&gt;
&lt;h3 id=&quot;1-通过GT的tcpdump插件&quot;&gt;&lt;a href=&quot;#1-通过GT的tcpdump插件&quot; class=&quot;headerlink&quot; title=&quot;1.通过GT的tcpdump插件&quot;&gt;&lt;/a&gt;1.通过GT的tcpdump插件&lt;/h3&gt;&lt;p&gt;这个是最简单粗暴的好方法~&lt;/p&gt;
&lt;p&gt;GT是腾讯出品的APP性能测试工具，已经在&lt;a href=&quot;https://github.com/TencentOpen/GT&quot;&gt;Github&lt;/a&gt;开源。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;进入GT的插件页面，点击抓包，调整tcpdump参数（一般默认即可），点击开始&lt;/li&gt;
&lt;li&gt;切换到要抓包的应用，操作完成后，切换回GT，停止抓包即可。&lt;/li&gt;
&lt;li&gt;抓包后生成pcap文件，用adb pull导出。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="游戏测试" scheme="http://jianbing.github.io/tags/%E6%B8%B8%E6%88%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>分享一个工具类库</title>
    <link href="http://jianbing.github.io/2016/03/29/share-test-library/"/>
    <id>http://jianbing.github.io/2016/03/29/share-test-library/</id>
    <published>2016-03-28T16:00:00.000Z</published>
    <updated>2016-10-27T08:38:25.519Z</updated>
    
    <content type="html"><![CDATA[<p>简单整理了下，把平时测试工作中用到的工具类库放到<a href="https://github.com/jianbing/utils" target="_blank" rel="external">Github</a>上了。</p>
<p>平时也是一个人折腾，写的也比较随意（哈哈，其实是新手水平了）。</p>
<p>简单介绍一下各个文件的主要内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">utils</div><div class="line">    android.py       主要是常用adb命令的封装</div><div class="line">    common.py        公共函数</div><div class="line">    decorators.py    自己常用的一些装饰器</div><div class="line">    cmdtool          封装了一个简单的命令行工具</div><div class="line">    tools            几个工具类</div><div class="line">        monitor.py       安卓app的CPU，内存占用情况的监视器，支持内存占用达到指定值的时候自动截图</div><div class="line">        biplist.py       在Github上淘到，可以解析IPA安装包里边的plist文件</div><div class="line">        sftpclient.py    基于paramiko简单封装的sftp客户端，平时主要用来下载内网配置表，看看发版时间</div><div class="line">        minipb.py   	 某天写着玩的迷你进度条</div><div class="line">        taskcenter.py    多线程池</div><div class="line">        adb.py           adb工具类</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;简单整理了下，把平时测试工作中用到的工具类库放到&lt;a href=&quot;https://github.com/jianbing/utils&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Github&lt;/a&gt;上了。&lt;/p&gt;
&lt;p&gt;平时也是一个人折腾，写的也比较随意
    
    </summary>
    
    
      <category term="测试工具" scheme="http://jianbing.github.io/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
</feed>
